<?php

/* @autogenerated */
declare(strict_types=1);

namespace Civi\Lughauth\Bootstrap\Plugin;

use Override;
use Slim\Routing\RouteCollectorProxy;
use Civi\Lughauth\Shared\Infrastructure\MicroPlugin;
use Civi\Lughauth\Features\Oidc\Authentication\Infrastructure\Driver\Html\AuthorizeHtml;
use Civi\Lughauth\Features\Oidc\Authentication\Infrastructure\Driver\Rest\DelegatedController;
use Civi\Lughauth\Features\Oidc\Authentication\Infrastructure\Driver\Rest\LogoutController;
use Civi\Lughauth\Features\Oidc\Authentication\Infrastructure\Driver\Rest\TokenController;
use Civi\Lughauth\Features\Oidc\Authentication\Infrastructure\Driver\Rest\UserInfoController;
use Civi\Lughauth\Features\Oidc\Client\Infrastructure\Driver\Rest\ApiKeyController;
use Civi\Lughauth\Features\Oidc\Key\Infrastructure\Driver\Rest\JwksController;
use Civi\Lughauth\Features\Oidc\Common\Infrastructure\Driver\Rest\OpenIdConfigurationController;

class OidcPlugin extends MicroPlugin
{
    #[Override]
    public function registerRoutes(RouteCollectorProxy $app)
    {
        $app->get('/oauth/openid/-/delegated/verify', [DelegatedController::class, 'verify']);
        $app->group('/oauth/openid/{tenant}', function (RouteCollectorProxy $group) {
            $group->get('/jwks', [JwksController::class, 'get']);
            $group->get('/.well-known/openid-configuration', [OpenIdConfigurationController::class, 'get']);
            $group->post('/token', [TokenController::class, 'post']);
            $group->post('/api-key/validate', [ApiKeyController::class, 'post']);
            $group->get('/userinfo', [UserInfoController::class, 'get']);

            $group->get('/logout', [LogoutController::class, 'logout']);
            $group->post('/revoke', [LogoutController::class, 'revoke']);

            $group->get('/authorize', [AuthorizeHtml::class, 'authorize']);
            $group->post('/authorize', [AuthorizeHtml::class, 'formAuthorize']);
            $group->get('/check-session', [AuthorizeHtml::class, 'refresh']);
            $group->post('/check-session', [AuthorizeHtml::class, 'refresh']);
        });
    }
}
