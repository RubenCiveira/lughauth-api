<?php

/* @autogenerated */
declare(strict_types=1);

namespace Civi\Lughauth\Bootstrap\Plugin;

use Override;
use Psr\Container\ContainerInterface;
use Civi\Lughauth\Shared\Event\EventListenersRegistrarInterface;
use Civi\Lughauth\Shared\Infrastructure\AggregatedMicroPlugin;
use Civi\Lughauth\Shared\Infrastructure\Management\Migration\MigrationManagement;
use Civi\Lughauth\Features\Access\UserAccessTemporalCode\Domain\Event\UserAccessTemporalCodeGeneratePasswordRecoverEvent;
use Civi\Lughauth\Features\Access\User\Domain\Event\UserCreateEvent;
use Civi\Lughauth\Features\Oidc\Authentication\Domain\AuthenticationResult;
use Civi\Lughauth\Features\Oidc\Common\Infrastructure\Driver\Management\OidcMigrationProvider;
use Civi\Lughauth\Features\Oidc\User\Application\Listener\NotifyLogin;
use Civi\Lughauth\Features\Oidc\User\Application\Listener\NotifyRecover;
use Civi\Lughauth\Features\Oidc\User\Application\Listener\NotifyCreate;

class MultiTenantPlugin extends AggregatedMicroPlugin
{
    public function __construct()
    {
        parent::__construct([
          new OidcPlugin()
        ]);
    }
    #[Override]
    public function registerEvents(EventListenersRegistrarInterface $bus): void
    {
        parent::registerEvents($bus);
        $bus->registerListener(AuthenticationResult::class, NotifyLogin::class);
        $bus->registerListener(UserCreateEvent::class, NotifyCreate::class);
        $bus->registerListener(UserAccessTemporalCodeGeneratePasswordRecoverEvent::class, NotifyRecover::class);
    }

    #[Override]
    public function getManagementsInterfaces(ContainerInterface $container): array
    {
        $migrations = $container->get(MigrationManagement::class);
        $migrations->addProvider($container->get(OidcMigrationProvider::class));
        return parent::getManagementsInterfaces($container);
    }
}
