<?php

/* @autogenerated */
declare(strict_types=1);

namespace Civi\Lughauth\Shared\Infrastructure\LongTask;

use DateTimeImmutable;
use Exception;

class TaskStepProgress
{
    public function __construct(
        public string $status,
        public ?int $totalItem,
        public ?int $processedItems,
        public ?string $error,
        public ?DateTimeImmutable $startTime,
        public ?DateTimeImmutable $endTime,
        public array $oks,
        public array $warns,
        public array $errors
    ) {
    }

    public function addOk(string $code)
    {
        $this->oks[] = $code;
        $this->processedItems = $this->countProcessedItems();
    }

    public function addWarn(string $code, string $message)
    {
        if (!$this->warns[$code]) {
            $this->warns[$code] = [];
        }
        $this->warns[$code][] = $message;
        $this->processedItems = $this->countProcessedItems();
    }

    public function addError(string $code, Exception $fail)
    {
        if (!$this->errors[$code]) {
            $this->errors[$code] = [];
        }
        $this->errors[$code] = $fail;
        $this->processedItems = $this->countProcessedItems();
    }

    private function countProcessedItems(): int
    {
        return count($this->oks) + count($this->warns) + count($this->errors);
    }
}
