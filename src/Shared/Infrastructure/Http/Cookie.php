<?php

/* @autogenerated */
declare(strict_types=1);

namespace Civi\Lughauth\Shared\Infrastructure\Http;

use Psr\Http\Message\ResponseInterface;

class Cookie
{
    public function __construct(
        public readonly string $name,
        public readonly ?string $value = null,
        public readonly ?\DateInterval $expiration = null,
        public readonly string $path = '/',
        public readonly string $domain = '',
        public readonly bool $sameSite = true,
        public readonly bool $secure = false,
        public readonly bool $httpOnly = true
    ) {
    }

    public function remove(ResponseInterface $response): ResponseInterface
    {
        return $this->attach($response, (new \DateTimeImmutable())->sub(new \DateInterval('PT1H')));
    }

    public function attach(ResponseInterface $response): ResponseInterface
    {
        $now = new \DateTimeImmutable();
        return $this->createCookie($response, $this->expiration ? $now->add($this->expiration) : $now);
    }
    public function createCookie(ResponseInterface $response, \DateTimeImmutable $expiration): ResponseInterface
    {
        $cookieHeaderValue = sprintf(
            '%s=%s; Expires=%s; Path=%s; %s%s',
            $this->name,
            $this->value ? urlencode($this->value) : '',
            gmdate('D, d M Y H:i:s T', $expiration->getTimestamp()),
            $this->path,
            $this->sameSite ? 'SameSite; ' : '',
            $this->secure ? 'Secure; ' : '',
            $this->httpOnly ? 'HttpOnly' : ''
        );
        return $response->withAddedHeader('Set-Cookie', $cookieHeaderValue);
    }
}
