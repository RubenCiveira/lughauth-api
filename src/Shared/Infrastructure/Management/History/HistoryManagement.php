<?php

/* @autogenerated */
declare(strict_types=1);

namespace Civi\Lughauth\Shared\Infrastructure\Management\History;

use Closure;
use Override;
use Civi\Lughauth\Shared\Exception\ConstraintException;
use Civi\Lughauth\Shared\Infrastructure\Audit\AuditQueryService;
use Civi\Lughauth\Shared\Infrastructure\Management\ManagementInterface;
use Psr\Http\Message\ServerRequestInterface;

class HistoryManagement implements ManagementInterface
{
    public function __construct(private readonly AuditQueryService $query)
    {
    }

    #[Override]
    public function name(): string
    {
        return 'history';
    }

    #[Override]
    public function get(): ?Closure
    {
        return function (ServerRequestInterface $request): array {
            $params = $request->getQueryParams();
            if (isset($params['entity']) && isset($params['id'])) {
                return $this->query->getEntityHistory($params['entity'], $params['id']);
            } else {
                throw ConstraintException::ofError('E1', ['entity', 'id'], ['', ''], ['not-null', 'not-null']);
            }
        };
    }

    #[Override]
    public function set(): ?Closure
    {
        return null;
    }
}
