<?php

/* @autogenerated */
declare(strict_types=1);

namespace Civi\Lughauth\Shared\Infrastructure\Management\Routes;

use Closure;
use Override;
use Slim\App;
use Civi\Lughauth\Shared\Infrastructure\Management\ManagementInterface;

/**
 * Exposes registered application routes for management purposes.
 */
class RoutesManagement implements ManagementInterface
{
    /**
     * Creates a new routes management handler.
     */
    public function __construct(
        /** @var App Slim application instance. */
        private readonly App $app
    ) {
    }

    /**
     * Returns the management endpoint name.
     */
    #[Override]
    public function name(): string
    {
        return 'routes';
    }

    /**
     * Returns a handler that lists declared routes.
     */
    #[Override]
    public function get(): ?Closure
    {
        return function (): array {
            $routeCollector = $this->app->getRouteCollector();
            $routes = $routeCollector->getRoutes();
            $declaredRoutes = [];
            foreach ($routes as $route) {
                $methods = $route->getMethods();
                $pattern = $route->getPattern();
                $name = $route->getName();
                foreach ($methods as $method) {
                    $declaredRoutes[] = [
                        'method' => $method,
                        'path' => $pattern . ($name ? " [name: $name]" : '')
                    ];
                }
            }
            return $declaredRoutes;
        };
    }

    /**
     * No write handler is provided for routes.
     */
    #[Override]
    public function set(): ?Closure
    {
        return null;
    }
}
