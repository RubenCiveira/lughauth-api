<?php

/* @autogenerated */
declare(strict_types=1);

namespace Civi\Lughauth\Shared\Infrastructure\View;

use Override;
use Psr\Http\Message\ServerRequestInterface;
use Slim\Routing\RouteContext;
use Twig\Environment;
use Twig\Loader\LoaderInterface;
use Twig\TwigFunction;

class AssetOptimizingTwigEnvironment extends Environment
{
    public function __construct(ServerRequestInterface $request, LoaderInterface $loader, array $options = [])
    {
        parent::__construct($loader, $options);

        $routeContext = RouteContext::fromRequest($request);
        $basePath = $routeContext->getBasePath();

        $this->addFunction(new TwigFunction('path', function (string $routeName, array $params = []) use ($basePath) {
            $url = $basePath . (str_starts_with($routeName, "/") ? "" : "/") . $routeName;
            if (!empty($params)) {
                $url .= '?' . http_build_query($params);
            }
            return $url;
        }));

        $this->addFunction(new TwigFunction('asset', function (string $routeName, array $params = []) use ($basePath) {
            $url = "{$basePath}/assets/{$routeName}";
            return $url;
        }));
    }

    #[Override]
    public function render($name, array $context = []): string
    {
        return parent::render($name, $context);
    }

    #[Override]
    public function display($name, array $context = []): void
    {
        echo $this->render($name, $context);
    }
}
