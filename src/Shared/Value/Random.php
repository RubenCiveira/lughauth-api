<?php

/* @autogenerated */
declare(strict_types=1);

namespace Civi\Lughauth\Shared\Value;

/**
 * Utility class for generating secure random identifiers and strings.
 *
 * This class provides static methods for generating random UUIDs, timestamp-based UUIDs (COMB),
 * API secrets, and passwords. It ensures cryptographic randomness when required.
 *
 * @api
 */
class Random
{
    /**
     * Generates a random UUID (version 4).
     *
     * This method uses the Ramsey\Uuid library to produce a 36-character universally unique identifier.
     *
     * @return string A valid UUID v4 string.
     */
    public static function uuid(): string
    {
        return \Ramsey\Uuid\Uuid::uuid4()->toString();
    }

    /**
     * Generates a "COMB" UUID by appending a timestamp to the beginning of a UUID.
     *
     * This is useful for making UUIDs more sequential and database-index friendly.
     *
     * Format: [first 20 chars of UUID] + [12-digit hex timestamp in milliseconds]
     *
     * @return string A 32-character string combining UUID and timestamp.
     */
    public static function comb(): string
    {
        // Genera un UUID aleatorio (v4)
        $uuid = \Ramsey\Uuid\Uuid::uuid4();
        // Obtener el timestamp actual en milisegundos
        $timestamp = (int) (microtime(true) * 1000);
        // Convierte el timestamp a un formato hexadecimal
        $timestampHex = dechex($timestamp);
        // AsegÃºrate de que el timestamp tenga 12 caracteres
        $timestampHex = str_pad($timestampHex, 12, '0', STR_PAD_LEFT);
        // Toma los primeros 20 caracteres del UUID y concatena el timestamp
        $combUuid = substr($uuid->toString(), 0, 20) . $timestampHex;
        return $combUuid;
    }

    /**
     * Generates a secure random string intended to be used as an API secret.
     *
     * @return string A cryptographically secure random string of 33 characters.
     */
    public static function apiSecret(): string
    {
        return self::generateSecureRandomString(33);
    }

    /**
     * Generates a secure random string intended to be used as a user password.
     *
     * @return string A cryptographically secure random string of 10 characters.
     */
    public static function password(): string
    {
        return self::generateSecureRandomString(10);
    }

    /**
     * Generates a secure random string composed of alphanumeric characters and symbols.
     *
     * Uses PHP's `random_int()` for cryptographic security.
     *
     * @param int $length The desired length of the random string.
     * @return string A cryptographically secure random string of the specified length.
     */
    private static function generateSecureRandomString(int $length): string
    {
        $characters = '0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ!@#$%^&*()';
        $charactersLength = strlen($characters);
        $randomString = '';

        for ($i = 0; $i < $length; $i++) {
            $randomString .= $characters[random_int(0, $charactersLength - 1)];
        }

        return $randomString;
    }
}
