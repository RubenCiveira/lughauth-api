<?php

/* @autogenerated */
declare(strict_types=1);

namespace Civi\Lughauth\Features\Access\Oidc\User\Application\Usecase;

use Psr\EventDispatcher\EventDispatcherInterface;
use Civi\Lughauth\Features\Access\Oidc\Authentication\Domain\AuthenticationRequest;
use Civi\Lughauth\Features\Access\Oidc\Authentication\Domain\AuthenticationResult;
use Civi\Lughauth\Features\Access\Oidc\Authentication\Domain\AuthorizedChalleges;
use Civi\Lughauth\Features\Access\Oidc\User\Domain\Gateway\LoginGateway;

class LoginUsecase
{
    public function __construct(
        private readonly EventDispatcherInterface $dispacher,
        private readonly LoginGateway $gateway
    ) {
    }

    public function fillPreLoadById(
        string $tenant,
        AuthenticationRequest $client,
        AuthorizedChalleges $challenges
    ): AuthenticationResult {
        $result = $this->gateway->fillPreLoadById($tenant, $client, $challenges);
        if ($result->valid && !$challenges->session) {
            $this->dispacher->dispatch($result);
        }
        return $result;
    }

    public function fillPreAuthenticated(
        string $tenant,
        AuthenticationRequest $client,
        AuthorizedChalleges $challenges
    ): AuthenticationResult {
        $result = $this->gateway->fillPreAuthenticated($tenant, $client, $challenges);
        if ($result->valid && !$challenges->session) {
            $this->dispacher->dispatch($result);
        }
        return $result;
    }

    public function validatedUserData(
        string $tenant,
        string $username,
        string $password,
        AuthenticationRequest $client
    ): AuthenticationResult {
        $result = $this->gateway->validatedUserData($tenant, $username, $password, $client);
        if ($result->valid) {
            $this->dispacher->dispatch($result);
        }
        return $result;
    }
}
