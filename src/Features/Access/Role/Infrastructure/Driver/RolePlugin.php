<?php

# @autogenerated
declare(strict_types=1);

namespace Civi\Lughauth\Features\Access\Role\Infrastructure\Driver;

use Override;
use Slim\Routing\RouteCollectorProxy;
use Civi\Lughauth\Features\Access\Role\Infrastructure\Driver\Rest\RoleAllowController;
use Civi\Lughauth\Features\Access\Role\Infrastructure\Driver\Rest\RoleListController;
use Civi\Lughauth\Features\Access\Role\Infrastructure\Driver\Rest\RoleCreateController;
use Civi\Lughauth\Features\Access\Role\Infrastructure\Driver\Rest\RoleRetrieveController;
use Civi\Lughauth\Features\Access\Role\Infrastructure\Driver\Rest\RoleUpdateController;
use Civi\Lughauth\Features\Access\Role\Infrastructure\Driver\Rest\RoleDeleteController;
use Civi\Lughauth\Shared\Infrastructure\MicroPlugin;
use Civi\Lughauth\Shared\Event\EventListenersRegistrarInterface;
use Civi\Lughauth\Features\Access\Role\Application\Service\Visibility\RoleFilterProposal;
use Civi\Lughauth\Features\Access\Role\Application\Policy\Filter\TenantAccesible;
use Civi\Lughauth\Features\Access\Role\Application\Policy\Fields\RoleExcludingdRoot;
use Civi\Lughauth\Features\Access\Role\Application\Service\Visibility\RoleFixedFieldsProposal;
use Civi\Lughauth\Features\Access\Role\Application\Policy\Allow\Create\IsAutenticatedCreateAllow;
use Civi\Lughauth\Features\Access\Role\Application\Policy\Allow\Update\IsAutenticatedUpdateAllow;
use Civi\Lughauth\Features\Access\Role\Application\Policy\Allow\Retrieve\IsAutenticatedRetrieveAllow;
use Civi\Lughauth\Features\Access\Role\Application\Policy\Allow\List\IsAutenticatedListAllow;
use Civi\Lughauth\Features\Access\Role\Application\Policy\Allow\Delete\IsAutenticatedDeleteAllow;
use Civi\Lughauth\Features\Access\Role\Application\Usecase\Delete\RoleDeleteAllowProposal;
use Civi\Lughauth\Features\Access\Role\Application\Usecase\Create\RoleCreateAllowDecision;
use Civi\Lughauth\Features\Access\Role\Application\Usecase\Update\RoleUpdateAllowDecision;
use Civi\Lughauth\Features\Access\Role\Application\Usecase\Retrieve\RoleRetrieveAllowDecision;
use Civi\Lughauth\Features\Access\Role\Application\Usecase\List\RoleListAllowDecision;
use Civi\Lughauth\Features\Access\Role\Application\Usecase\Delete\RoleDeleteAllowDecision;

class RolePlugin extends MicroPlugin
{
    #[Override]
    public function registerRoutes(RouteCollectorProxy $app)
    {
        $app->group('/api/access/roles', [$this, 'setRoutesForRole']);
        $app->group('/api/me/acl/access/roles', [$this, 'setRoutesForRoleAcl']);
    }
    #[Override]
    public function registerEvents(EventListenersRegistrarInterface $bus)
    {
        $bus->registerListener(RoleFilterProposal::class, TenantAccesible::class);
        $bus->registerListener(RoleFixedFieldsProposal::class, RoleExcludingdRoot::class);
        $bus->registerListener(RoleCreateAllowDecision::class, IsAutenticatedCreateAllow::class);
        $bus->registerListener(RoleUpdateAllowDecision::class, IsAutenticatedUpdateAllow::class);
        $bus->registerListener(RoleRetrieveAllowDecision::class, IsAutenticatedRetrieveAllow::class);
        $bus->registerListener(RoleListAllowDecision::class, IsAutenticatedListAllow::class);
        $bus->registerListener(RoleDeleteAllowDecision::class, IsAutenticatedDeleteAllow::class);
    }
    public function setRoutesForRoleAcl(RouteCollectorProxy $roleGroup)
    {
        $roleGroup->get('', [RoleAllowController::class, 'genericAllow']);
        $roleGroup->get('/{uid}', [RoleAllowController::class, 'contextualAllow']);
    }
    public function setRoutesForRole(RouteCollectorProxy $roleGroup)
    {
        $roleGroup->get('', [RoleListController::class, 'list']);
        $roleGroup->post('', [RoleCreateController::class, 'create']);
        $roleGroup->get('/{uid}', [RoleRetrieveController::class, 'retrieve']);
        $roleGroup->put('/{uid}', [RoleUpdateController::class, 'update']);
        $roleGroup->delete('/{uid}', [RoleDeleteController::class, 'delete']);
        $roleGroup->delete('', [RoleDeleteController::class, 'deleteAllForQuery']);
        $roleGroup->get('/~/delete-status/{uid}', [RoleDeleteController::class, 'checkDeleteAllForQueryStatus']);
    }
}
