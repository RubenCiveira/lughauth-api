<?php

# @autogenerated
declare(strict_types=1);

namespace Civi\Lughauth\Features\Access\Role\Domain;

use Civi\Lughauth\Features\Access\Role\Domain\ValueObject\RoleUidVO;
use Civi\Lughauth\Features\Access\Role\Domain\ValueObject\RoleNameVO;
use Civi\Lughauth\Features\Access\Role\Domain\ValueObject\Accesor\RoleNameAccesor;
use Civi\Lughauth\Features\Access\Role\Domain\ValueObject\RoleRelyingPartyVO;
use Civi\Lughauth\Features\Access\Role\Domain\ValueObject\Accesor\RoleRelyingPartyAccesor;
use Civi\Lughauth\Features\Access\Role\Domain\ValueObject\RoleVersionVO;
use Civi\Lughauth\Features\Access\Role\Domain\ValueObject\Accesor\RoleVersionAccesor;
use Civi\Lughauth\Features\Access\Role\Domain\Event\RoleCreateEvent;
use Civi\Lughauth\Features\Access\Role\Domain\Event\RoleUpdateEvent;
use Civi\Lughauth\Features\Access\Role\Domain\Event\RoleDeleteEvent;
use Civi\Lughauth\Features\Access\RelyingParty\Domain\RelyingPartyRef;

class Role extends RoleRef
{
    use RoleNameAccesor;
    use RoleRelyingPartyAccesor;
    use RoleVersionAccesor;
    private array $recordedEvents = [];

    public function __construct(
        RoleUidVO|string $uid,
        RoleNameVO|string $name,
        RoleRelyingPartyVO|RelyingPartyRef|null $relyingParty = null,
        RoleVersionVO|int|null $version = null,
    ) {
        parent::__construct($uid);
        $this->_name = RoleNameVO::from($name);
        $this->_relyingParty = null === $relyingParty ? RoleRelyingPartyVO::empty() : RoleRelyingPartyVO::from($relyingParty);
        $this->_version = null === $version ? RoleVersionVO::empty() : RoleVersionVO::from($version);
    }
    public function replace(RoleAttributes $values): Role
    {
        $value = clone $this;
        $value->_name = $values->getNameOrDefault($this->_name);
        $value->_relyingParty = $values->getRelyingPartyOrDefault($this->_relyingParty);
        $value->_version = $values->getVersionOrDefault($this->_version);
        return $value;
    }
    public static function calculatedFields(): array
    {
        return [];
    }
    public static function create(RoleAttributes $values): Role
    {
        $value = $values->build();
        $value->recordedEvents[] = new RoleCreateEvent($value);
        return $value;
    }
    public function update(RoleAttributes $values): Role
    {
        $value = $this->replace($values);
        $value->recordedEvents[] = new RoleUpdateEvent($value, $this);
        return $value;
    }
    public function delete(): Role
    {
        $value = clone $this;
        $value->recordedEvents[] = new RoleDeleteEvent($value);
        return $value;
    }
    public function asPublicJson(): array
    {
        $data = [];
        $data['uid'] = $this->uid();
        $data['name'] = $this->getName();
        $relyingParty = $this->getRelyingParty()?->uid();
        if ($relyingParty) {
            $data['relyingParty'] = ['$ref' => $relyingParty];
        }
        $data['version'] = $this->getVersion();
        return $data;
    }
    public function toAttributes(): RoleAttributes
    {
        return (new RoleAttributes())
          ->uid($this->uid())
          ->name($this->_name)
          ->relyingParty($this->_relyingParty)
          ->version($this->_version);
    }
    public function getTheEvents(): array
    {
        return [...$this->recordedEvents];
    }
}
