<?php

# @autogenerated
declare(strict_types=1);

namespace Civi\Lughauth\Features\Access\ApiKeyClient\Infrastructure\Driver;

use Psr\Container\ContainerInterface;
use Override;
use Slim\Routing\RouteCollectorProxy;
use Civi\Lughauth\Features\Access\ApiKeyClient\Infrastructure\Driver\Rest\ApiKeyClientAllowController;
use Civi\Lughauth\Features\Access\ApiKeyClient\Infrastructure\Driver\Rest\ApiKeyClientListController;
use Civi\Lughauth\Features\Access\ApiKeyClient\Infrastructure\Driver\Rest\ApiKeyClientCreateController;
use Civi\Lughauth\Features\Access\ApiKeyClient\Infrastructure\Driver\Rest\ApiKeyClientRetrieveController;
use Civi\Lughauth\Features\Access\ApiKeyClient\Infrastructure\Driver\Rest\ApiKeyClientUpdateController;
use Civi\Lughauth\Features\Access\ApiKeyClient\Infrastructure\Driver\Rest\ApiKeyClientDeleteController;
use Civi\Lughauth\Features\Access\ApiKeyClient\Infrastructure\Driver\Rest\ApiKeyClientEnableController;
use Civi\Lughauth\Features\Access\ApiKeyClient\Infrastructure\Driver\Rest\ApiKeyClientDisableController;
use Civi\Lughauth\Shared\Security\Rbac\Handler;
use Civi\Lughauth\Shared\Infrastructure\MicroPlugin;
use Civi\Lughauth\Shared\Infrastructure\MicroPlugin\GenericSecurityPlugin;
use Civi\Lughauth\Shared\Infrastructure\StartupProcessor;
use Civi\Lughauth\Shared\Event\EventListenersRegistrarInterface;
use Civi\Lughauth\Features\Access\ApiKeyClient\Application\Policy\Allow\Create\CreateApiKeyClientOnlyForRootAllow;
use Civi\Lughauth\Features\Access\ApiKeyClient\Application\Usecase\Create\ApiKeyClientCreateAllowDecision;
use Civi\Lughauth\Features\Access\ApiKeyClient\Application\Policy\Allow\Create\IsAutenticatedCreateAllow;
use Civi\Lughauth\Features\Access\ApiKeyClient\Application\Policy\Allow\Update\IsAutenticatedUpdateAllow;
use Civi\Lughauth\Features\Access\ApiKeyClient\Application\Usecase\Update\ApiKeyClientUpdateAllowDecision;
use Civi\Lughauth\Features\Access\ApiKeyClient\Application\Policy\Allow\Update\UpdateApiKeyClientOnlyForRootAllow;
use Civi\Lughauth\Features\Access\ApiKeyClient\Application\Policy\Allow\Retrieve\RetrieveApiKeyClientOnlyForRootAllow;
use Civi\Lughauth\Features\Access\ApiKeyClient\Application\Usecase\Retrieve\ApiKeyClientRetrieveAllowDecision;
use Civi\Lughauth\Features\Access\ApiKeyClient\Application\Policy\Allow\Retrieve\IsAutenticatedRetrieveAllow;
use Civi\Lughauth\Features\Access\ApiKeyClient\Application\Policy\Allow\List\ListApiKeyClientOnlyForRootAllow;
use Civi\Lughauth\Features\Access\ApiKeyClient\Application\Usecase\List\ApiKeyClientListAllowDecision;
use Civi\Lughauth\Features\Access\ApiKeyClient\Application\Policy\Allow\List\IsAutenticatedListAllow;
use Civi\Lughauth\Features\Access\ApiKeyClient\Application\Policy\Allow\Delete\DeleteApiKeyClientOnlyForRootAllow;
use Civi\Lughauth\Features\Access\ApiKeyClient\Application\Usecase\Delete\ApiKeyClientDeleteAllowDecision;
use Civi\Lughauth\Features\Access\ApiKeyClient\Application\Policy\Allow\Delete\IsAutenticatedDeleteAllow;
use Civi\Lughauth\Features\Access\ApiKeyClient\Application\Policy\Allow\Enable\EnableApiKeyClientOnlyForRootAllow;
use Civi\Lughauth\Features\Access\ApiKeyClient\Application\Usecase\Enable\ApiKeyClientEnableAllowDecision;
use Civi\Lughauth\Features\Access\ApiKeyClient\Application\Policy\Allow\Enable\IsAutenticatedEnableAllow;
use Civi\Lughauth\Features\Access\ApiKeyClient\Application\Policy\Allow\Disable\DisableApiKeyClientOnlyForRootAllow;
use Civi\Lughauth\Features\Access\ApiKeyClient\Application\Usecase\Disable\ApiKeyClientDisableAllowDecision;
use Civi\Lughauth\Features\Access\ApiKeyClient\Application\Policy\Allow\Disable\IsAutenticatedDisableAllow;

class ApiKeyClientPlugin extends MicroPlugin
{
    #[Override]
    public function registerRoutes(RouteCollectorProxy $collector): void
    {
        $collector->group('/api/access/api-key-clients', [$this, 'setRoutesForApiKeyClient']);
        $collector->group('/api/me/acl/access/api-key-clients', [$this, 'setRoutesForApiKeyClientAcl']);
    }
    #[Override]
    public function registerEvents(EventListenersRegistrarInterface $bus): void
    {
        $bus->registerListener(ApiKeyClientCreateAllowDecision::class, CreateApiKeyClientOnlyForRootAllow::class);
        $bus->registerListener(ApiKeyClientCreateAllowDecision::class, IsAutenticatedCreateAllow::class);
        $bus->registerListener(ApiKeyClientUpdateAllowDecision::class, IsAutenticatedUpdateAllow::class);
        $bus->registerListener(ApiKeyClientUpdateAllowDecision::class, UpdateApiKeyClientOnlyForRootAllow::class);
        $bus->registerListener(ApiKeyClientRetrieveAllowDecision::class, RetrieveApiKeyClientOnlyForRootAllow::class);
        $bus->registerListener(ApiKeyClientRetrieveAllowDecision::class, IsAutenticatedRetrieveAllow::class);
        $bus->registerListener(ApiKeyClientListAllowDecision::class, ListApiKeyClientOnlyForRootAllow::class);
        $bus->registerListener(ApiKeyClientListAllowDecision::class, IsAutenticatedListAllow::class);
        $bus->registerListener(ApiKeyClientDeleteAllowDecision::class, DeleteApiKeyClientOnlyForRootAllow::class);
        $bus->registerListener(ApiKeyClientDeleteAllowDecision::class, IsAutenticatedDeleteAllow::class);
        $bus->registerListener(ApiKeyClientEnableAllowDecision::class, EnableApiKeyClientOnlyForRootAllow::class);
        $bus->registerListener(ApiKeyClientEnableAllowDecision::class, IsAutenticatedEnableAllow::class);
        $bus->registerListener(ApiKeyClientDisableAllowDecision::class, DisableApiKeyClientOnlyForRootAllow::class);
        $bus->registerListener(ApiKeyClientDisableAllowDecision::class, IsAutenticatedDisableAllow::class);
    }
    #[Override]
    public function registerStartup(StartupProcessor $processor): void
    {
        $processor->register(function (ContainerInterface $container) {
            $handler = $container->get(Handler::class);
            $handler->registerResourceAction("api-key-client", "list", "READ");
            $handler->registerResourceAction("api-key-client", "create", "WRITE");
            $handler->registerResourceAction("api-key-client", "retrieve", "READ");
            $handler->registerResourceAction("api-key-client", "update", "WRITE");
            $handler->registerResourceAction("api-key-client", "delete", "WRITE");
            $handler->registerResourceAction("api-key-client", "enable", "WRITE");
            $handler->registerResourceAction("api-key-client", "disable", "WRITE");

            $handler->registerResourceAttribute("api-key-client", "code", "MANAGE");
            $handler->registerResourceAttribute("api-key-client", "key", "MANAGE");
            $handler->registerResourceAttribute("api-key-client", "enabled", "MANAGE");
            $handler->registerResourceAttribute("api-key-client", "scopes", "MANAGE");
            $handler->registerResourceAttribute("api-key-client", "version", "MANAGE");
        }, StartupProcessor::before(GenericSecurityPlugin::STARTUP_ORDER));
    }
    public function setRoutesForApiKeyClientAcl(RouteCollectorProxy $apiKeyClientGroup): void
    {
        $apiKeyClientGroup->get('', [ApiKeyClientAllowController::class, 'genericAllow']);
        $apiKeyClientGroup->get('/{uid}', [ApiKeyClientAllowController::class, 'contextualAllow']);
    }
    public function setRoutesForApiKeyClient(RouteCollectorProxy $apiKeyClientGroup): void
    {
        $apiKeyClientGroup->get('', [ApiKeyClientListController::class, 'list']);
        $apiKeyClientGroup->post('', [ApiKeyClientCreateController::class, 'create']);
        $apiKeyClientGroup->get('/{uid}', [ApiKeyClientRetrieveController::class, 'retrieve']);
        $apiKeyClientGroup->put('/{uid}', [ApiKeyClientUpdateController::class, 'update']);
        $apiKeyClientGroup->delete('/{uid}', [ApiKeyClientDeleteController::class, 'delete']);
        $apiKeyClientGroup->delete('', [ApiKeyClientDeleteController::class, 'deleteAllForQuery']);
        $apiKeyClientGroup->get('/~/delete-status/{uid}', [ApiKeyClientDeleteController::class, 'checkDeleteAllForQueryStatus']);
        $apiKeyClientGroup->patch('/~/enable', [ApiKeyClientEnableController::class, 'enableAllForQuery']);
        $apiKeyClientGroup->patch('/{uid}/enable', [ApiKeyClientEnableController::class, 'enable']);
        $apiKeyClientGroup->get('/~/enable-status/{uid}', [ApiKeyClientEnableController::class, 'checkEnableAllForQueryStatus']);
        $apiKeyClientGroup->patch('/~/disable', [ApiKeyClientDisableController::class, 'disableAllForQuery']);
        $apiKeyClientGroup->patch('/{uid}/disable', [ApiKeyClientDisableController::class, 'disable']);
        $apiKeyClientGroup->get('/~/disable-status/{uid}', [ApiKeyClientDisableController::class, 'checkDisableAllForQueryStatus']);
    }
}
