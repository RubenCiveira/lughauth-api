<?php

# @autogenerated
declare(strict_types=1);

namespace Civi\Lughauth\Features\Access\SecurityScope\Domain\ValueObject\Holder;

use Civi\Lughauth\Shared\Value\Validation\ConstraintFailList;
use Civi\Lughauth\Features\Access\SecurityScope\Domain\ValueObject\SecurityScopeVisibilityVO;

trait SecurityScopeVisibilityAttributeHolder
{
    protected SecurityScopeVisibilityVO|string|null $visibility = null;
    protected bool $visibilityAssigned = false;

    public function getVisibilityOrDefault(?SecurityScopeVisibilityVO $visibility): SecurityScopeVisibilityVO|string|null
    {
        return $this->visibilityAssigned ? ($this->visibility !== null ? SecurityScopeVisibilityVO::from($this->visibility) : null) : $visibility;
    }
    public function visibility(SecurityScopeVisibilityVO|string|null $visibility): static
    {
        $this->visibility = $visibility;
        $this->visibilityAssigned = true;
        return $this;
    }
    public function getVisibility(): ?string
    {
        return is_a($this->visibility, SecurityScopeVisibilityVO::class) ? $this->visibility->value() : $this->visibility;
    }
    public function unsetVisibility(): static
    {
        $this->visibility = null;
        $this->visibilityAssigned = false;
        return $this;
    }
    protected function withDefaultVisibility(): void
    {
        if ($this->visibility === null) {
            $this->visibility = 'EXPLICIT';
        }
    }
    protected function withAssertedVisibilityRules(self $value, ConstraintFailList $errorsList): void
    {
        if ($value->visibilityAssigned = $this->visibilityAssigned) {
            $value->visibility = SecurityScopeVisibilityVO::tryFrom($this->visibility, $errorsList);
        }
    }
}
