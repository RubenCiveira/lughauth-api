<?php

# @autogenerated
declare(strict_types=1);

namespace Civi\Lughauth\Features\Access\SecurityScope\Domain;

use Civi\Lughauth\Features\Access\SecurityScope\Domain\ValueObject\SecurityScopeUidVO;
use Civi\Lughauth\Features\Access\SecurityScope\Domain\ValueObject\SecurityScopeTrustedClientVO;
use Civi\Lughauth\Features\Access\SecurityScope\Domain\ValueObject\Accesor\SecurityScopeTrustedClientAccesor;
use Civi\Lughauth\Features\Access\SecurityScope\Domain\ValueObject\SecurityScopeRelyingPartyVO;
use Civi\Lughauth\Features\Access\SecurityScope\Domain\ValueObject\Accesor\SecurityScopeRelyingPartyAccesor;
use Civi\Lughauth\Features\Access\SecurityScope\Domain\ValueObject\SecurityScopeResourceVO;
use Civi\Lughauth\Features\Access\SecurityScope\Domain\ValueObject\Accesor\SecurityScopeResourceAccesor;
use Civi\Lughauth\Features\Access\SecurityScope\Domain\ValueObject\SecurityScopeScopeVO;
use Civi\Lughauth\Features\Access\SecurityScope\Domain\ValueObject\Accesor\SecurityScopeScopeAccesor;
use Civi\Lughauth\Features\Access\SecurityScope\Domain\ValueObject\SecurityScopeEnabledVO;
use Civi\Lughauth\Features\Access\SecurityScope\Domain\ValueObject\Accesor\SecurityScopeEnabledAccesor;
use Civi\Lughauth\Features\Access\SecurityScope\Domain\ValueObject\SecurityScopeKindVO;
use Civi\Lughauth\Features\Access\SecurityScope\Domain\ValueObject\Accesor\SecurityScopeKindAccesor;
use Civi\Lughauth\Features\Access\SecurityScope\Domain\ValueObject\SecurityScopeVisibilityVO;
use Civi\Lughauth\Features\Access\SecurityScope\Domain\ValueObject\Accesor\SecurityScopeVisibilityAccesor;
use Civi\Lughauth\Features\Access\SecurityScope\Domain\ValueObject\SecurityScopeVersionVO;
use Civi\Lughauth\Features\Access\SecurityScope\Domain\ValueObject\Accesor\SecurityScopeVersionAccesor;
use Civi\Lughauth\Features\Access\SecurityScope\Domain\Formula\EnabledCalculator;
use Civi\Lughauth\Features\Access\SecurityScope\Domain\Event\SecurityScopeCreateEvent;
use Civi\Lughauth\Features\Access\SecurityScope\Domain\Event\SecurityScopeUpdateEvent;
use Civi\Lughauth\Features\Access\SecurityScope\Domain\Event\SecurityScopeDeleteEvent;
use Civi\Lughauth\Features\Access\SecurityScope\Domain\Event\SecurityScopeDisableEvent;
use Civi\Lughauth\Features\Access\SecurityScope\Domain\Event\SecurityScopeEnableEvent;
use Civi\Lughauth\Features\Access\TrustedClient\Domain\TrustedClientRef;
use Civi\Lughauth\Features\Access\RelyingParty\Domain\RelyingPartyRef;

class SecurityScope extends SecurityScopeRef
{
    use SecurityScopeTrustedClientAccesor;
    use SecurityScopeRelyingPartyAccesor;
    use SecurityScopeResourceAccesor;
    use SecurityScopeScopeAccesor;
    use SecurityScopeEnabledAccesor;
    use SecurityScopeKindAccesor;
    use SecurityScopeVisibilityAccesor;
    use SecurityScopeVersionAccesor;
    private array $recordedEvents = [];

    public function __construct(
        SecurityScopeUidVO|string $uid,
        SecurityScopeResourceVO|string $resource,
        SecurityScopeScopeVO|string $scope,
        SecurityScopeTrustedClientVO|TrustedClientRef|null $trustedClient = null,
        SecurityScopeRelyingPartyVO|RelyingPartyRef|null $relyingParty = null,
        SecurityScopeEnabledVO|bool|null $enabled = null,
        SecurityScopeKindVO|string|null $kind = null,
        SecurityScopeVisibilityVO|string|null $visibility = null,
        SecurityScopeVersionVO|int|null $version = null,
    ) {
        parent::__construct($uid);
        $this->_trustedClient = null === $trustedClient ? SecurityScopeTrustedClientVO::empty() : SecurityScopeTrustedClientVO::from($trustedClient);
        $this->_relyingParty = null === $relyingParty ? SecurityScopeRelyingPartyVO::empty() : SecurityScopeRelyingPartyVO::from($relyingParty);
        $this->_resource = SecurityScopeResourceVO::from($resource);
        $this->_scope = SecurityScopeScopeVO::from($scope);
        $this->_enabled = null === $enabled ? SecurityScopeEnabledVO::empty() : SecurityScopeEnabledVO::from($enabled);
        $this->_kind = null === $kind ? SecurityScopeKindVO::empty() : SecurityScopeKindVO::from($kind);
        $this->_visibility = null === $visibility ? SecurityScopeVisibilityVO::empty() : SecurityScopeVisibilityVO::from($visibility);
        $this->_version = null === $version ? SecurityScopeVersionVO::empty() : SecurityScopeVersionVO::from($version);
    }
    public function replace(SecurityScopeAttributes $values): SecurityScope
    {
        $value = clone $this;
        $value->_trustedClient = $values->getTrustedClientOrDefault($this->_trustedClient);
        $value->_relyingParty = $values->getRelyingPartyOrDefault($this->_relyingParty);
        $value->_resource = $values->getResourceOrDefault($this->_resource);
        $value->_scope = $values->getScopeOrDefault($this->_scope);
        $value->_enabled = $values->getEnabledOrDefault($this->_enabled);
        $value->_kind = $values->getKindOrDefault($this->_kind);
        $value->_visibility = $values->getVisibilityOrDefault($this->_visibility);
        $value->_version = $values->getVersionOrDefault($this->_version);
        return $value;
    }
    public static function calculatedFields(): array
    {
        return [ 'enabled'];
    }
    public static function create(SecurityScopeAttributes $values): SecurityScope
    {
        $calculated = clone $values;
        $calculated->enabled(EnabledCalculator::calculateEnabled());
        $value = $calculated->build();
        $value->recordedEvents[] = new SecurityScopeCreateEvent($value);
        return $value;
    }
    public function update(SecurityScopeAttributes $values): SecurityScope
    {
        $calculated = clone $values;
        $calculated->enabled(EnabledCalculator::calculateEnabled($this));
        $value = $this->replace($calculated);
        $value->recordedEvents[] = new SecurityScopeUpdateEvent($value);
        return $value;
    }
    public function delete(): SecurityScope
    {
        $value = clone $this;
        $value->recordedEvents[] = new SecurityScopeDeleteEvent($value);
        return $value;
    }
    public function disable(): SecurityScope
    {
        $value = clone $this;
        $value->_enabled = SecurityScopeEnabledVO::from(false);
        $value->recordedEvents[] = new SecurityScopeDisableEvent(payload: $value);
        return $value;
    }
    public function enable(): SecurityScope
    {
        $value = clone $this;
        $value->_enabled = SecurityScopeEnabledVO::from(true);
        $value->recordedEvents[] = new SecurityScopeEnableEvent(payload: $value);
        return $value;
    }
    public function toAttributes(): SecurityScopeAttributes
    {
        return (new SecurityScopeAttributes())
          ->uid($this->uid())
          ->trustedClient($this->_trustedClient)
          ->relyingParty($this->_relyingParty)
          ->resource($this->_resource)
          ->scope($this->_scope)
          ->enabled($this->_enabled)
          ->kind($this->_kind)
          ->visibility($this->_visibility)
          ->version($this->_version);
    }
    public function getTheEvents(): array
    {
        return [...$this->recordedEvents];
    }
}
