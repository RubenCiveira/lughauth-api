<?php

# @autogenerated
declare(strict_types=1);

namespace Civi\Lughauth\Features\Access\ScopeAssignation\Infrastructure\Driver\Batch;

use Override;
use Civi\Lughauth\Features\Access\ScopeAssignation\Domain\Gateway\ScopeAssignationCursor;
use Civi\Lughauth\Shared\Infrastructure\LongTask\TaskContext;
use Civi\Lughauth\Shared\Infrastructure\LongTask\TaskCounterInterface;
use Civi\Lughauth\Shared\Infrastructure\LongTask\TaskReaderInterface;
use Civi\Lughauth\Features\Access\ScopeAssignation\Application\Usecase\List\ScopeAssignationListUsecase;

class ScopeAssignationTaskReader implements TaskReaderInterface, TaskCounterInterface
{
    public function __construct(private readonly ScopeAssignationListUsecase $usecase)
    {

    }
    #[Override]
    public function read(TaskContext $context): array
    {
        $filter = $context->params['filter'];
        $cursor = $context->cursor;
        $result = $this->usecase->list($filter, $cursor ?? new ScopeAssignationCursor(limit: 1));
        $context->cursor = $result->cursor();
        return $result->values();
    }

    #[Override]
    public function expectedTotal(TaskContext $context): int
    {
        $filter = $context->params['filter'];
        return $this->usecase->count($filter);
    }
}
