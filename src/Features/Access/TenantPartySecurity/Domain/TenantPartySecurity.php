<?php

# @autogenerated
declare(strict_types=1);

namespace Civi\Lughauth\Features\Access\TenantPartySecurity\Domain;

use Civi\Lughauth\Features\Access\TenantPartySecurity\Domain\ValueObject\TenantPartySecurityUidVO;
use Civi\Lughauth\Features\Access\TenantPartySecurity\Domain\ValueObject\TenantPartySecurityTenantVO;
use Civi\Lughauth\Features\Access\TenantPartySecurity\Domain\ValueObject\Accesor\TenantPartySecurityTenantAccesor;
use Civi\Lughauth\Features\Access\TenantPartySecurity\Domain\ValueObject\TenantPartySecurityRelyingPartyVO;
use Civi\Lughauth\Features\Access\TenantPartySecurity\Domain\ValueObject\Accesor\TenantPartySecurityRelyingPartyAccesor;
use Civi\Lughauth\Features\Access\TenantPartySecurity\Domain\ValueObject\TenantPartySecurityPoliciesVO;
use Civi\Lughauth\Features\Access\TenantPartySecurity\Domain\ValueObject\Accesor\TenantPartySecurityPoliciesAccesor;
use Civi\Lughauth\Features\Access\TenantPartySecurity\Domain\ValueObject\TenantPartySecurityVersionVO;
use Civi\Lughauth\Features\Access\TenantPartySecurity\Domain\ValueObject\Accesor\TenantPartySecurityVersionAccesor;
use Civi\Lughauth\Features\Access\TenantPartySecurity\Domain\Event\TenantPartySecurityCreateEvent;
use Civi\Lughauth\Features\Access\TenantPartySecurity\Domain\Event\TenantPartySecurityUpdateEvent;
use Civi\Lughauth\Features\Access\TenantPartySecurity\Domain\Event\TenantPartySecurityDeleteEvent;
use Civi\Lughauth\Features\Access\Tenant\Domain\TenantRef;
use Civi\Lughauth\Features\Access\RelyingParty\Domain\RelyingPartyRef;

class TenantPartySecurity extends TenantPartySecurityRef
{
    use TenantPartySecurityTenantAccesor;
    use TenantPartySecurityRelyingPartyAccesor;
    use TenantPartySecurityPoliciesAccesor;
    use TenantPartySecurityVersionAccesor;
    private array $recordedEvents = [];

    public function __construct(
        TenantPartySecurityUidVO|string $uid,
        TenantPartySecurityTenantVO|TenantRef $tenant,
        TenantPartySecurityRelyingPartyVO|RelyingPartyRef $relyingParty,
        TenantPartySecurityPoliciesVO|string|null $policies = null,
        TenantPartySecurityVersionVO|int|null $version = null,
    ) {
        parent::__construct($uid);
        $this->_tenant = TenantPartySecurityTenantVO::from($tenant);
        $this->_relyingParty = TenantPartySecurityRelyingPartyVO::from($relyingParty);
        $this->_policies = null === $policies ? TenantPartySecurityPoliciesVO::empty() : TenantPartySecurityPoliciesVO::from($policies);
        $this->_version = null === $version ? TenantPartySecurityVersionVO::empty() : TenantPartySecurityVersionVO::from($version);
    }
    public function replace(TenantPartySecurityAttributes $values): TenantPartySecurity
    {
        $value = clone $this;
        $value->_tenant = $values->getTenantOrDefault($this->_tenant);
        $value->_relyingParty = $values->getRelyingPartyOrDefault($this->_relyingParty);
        $value->_policies = $values->getPoliciesOrDefault($this->_policies);
        $value->_version = $values->getVersionOrDefault($this->_version);
        return $value;
    }
    public static function calculatedFields(): array
    {
        return [];
    }
    public static function create(TenantPartySecurityAttributes $values): TenantPartySecurity
    {
        $value = $values->build();
        $value->recordedEvents[] = new TenantPartySecurityCreateEvent($value);
        return $value;
    }
    public function update(TenantPartySecurityAttributes $values): TenantPartySecurity
    {
        $value = $this->replace($values);
        $value->recordedEvents[] = new TenantPartySecurityUpdateEvent($value, $this);
        return $value;
    }
    public function delete(): TenantPartySecurity
    {
        $value = clone $this;
        $value->recordedEvents[] = new TenantPartySecurityDeleteEvent($value);
        return $value;
    }
    public function asPublicJson(): array
    {
        $data = [];
        $data['uid'] = $this->uid();
        $tenant = $this->getTenant()?->uid();
        if ($tenant) {
            $data['tenant'] = ['$ref' => $tenant];
        }
        $relyingParty = $this->getRelyingParty()?->uid();
        if ($relyingParty) {
            $data['relyingParty'] = ['$ref' => $relyingParty];
        }
        $data['version'] = $this->getVersion();
        return $data;
    }
    public function toAttributes(): TenantPartySecurityAttributes
    {
        return (new TenantPartySecurityAttributes())
          ->uid($this->uid())
          ->tenant($this->_tenant)
          ->relyingParty($this->_relyingParty)
          ->policies($this->_policies)
          ->version($this->_version);
    }
    public function getTheEvents(): array
    {
        return [...$this->recordedEvents];
    }
}
