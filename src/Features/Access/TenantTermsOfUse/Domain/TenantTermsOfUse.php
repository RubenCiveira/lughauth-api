<?php

# @autogenerated
declare(strict_types=1);

namespace Civi\Lughauth\Features\Access\TenantTermsOfUse\Domain;

use Civi\Lughauth\Features\Access\TenantTermsOfUse\Domain\ValueObject\TenantTermsOfUseUidVO;
use Civi\Lughauth\Features\Access\TenantTermsOfUse\Domain\ValueObject\TenantTermsOfUseTenantVO;
use Civi\Lughauth\Features\Access\TenantTermsOfUse\Domain\ValueObject\Accesor\TenantTermsOfUseTenantAccesor;
use Civi\Lughauth\Features\Access\TenantTermsOfUse\Domain\ValueObject\TenantTermsOfUseTextVO;
use Civi\Lughauth\Features\Access\TenantTermsOfUse\Domain\ValueObject\Accesor\TenantTermsOfUseTextAccesor;
use Civi\Lughauth\Features\Access\TenantTermsOfUse\Domain\ValueObject\TenantTermsOfUseEnabledVO;
use Civi\Lughauth\Features\Access\TenantTermsOfUse\Domain\ValueObject\Accesor\TenantTermsOfUseEnabledAccesor;
use Civi\Lughauth\Features\Access\TenantTermsOfUse\Domain\ValueObject\TenantTermsOfUseAttachedVO;
use Civi\Lughauth\Features\Access\TenantTermsOfUse\Domain\ValueObject\Accesor\TenantTermsOfUseAttachedAccesor;
use Civi\Lughauth\Features\Access\TenantTermsOfUse\Domain\ValueObject\TenantTermsOfUseActivationDateVO;
use Civi\Lughauth\Features\Access\TenantTermsOfUse\Domain\ValueObject\Accesor\TenantTermsOfUseActivationDateAccesor;
use Civi\Lughauth\Features\Access\TenantTermsOfUse\Domain\ValueObject\TenantTermsOfUseVersionVO;
use Civi\Lughauth\Features\Access\TenantTermsOfUse\Domain\ValueObject\Accesor\TenantTermsOfUseVersionAccesor;
use Civi\Lughauth\Features\Access\TenantTermsOfUse\Domain\Formula\EnabledCalculator;
use Civi\Lughauth\Features\Access\TenantTermsOfUse\Domain\Event\TenantTermsOfUseCreateEvent;
use Civi\Lughauth\Features\Access\TenantTermsOfUse\Domain\Event\TenantTermsOfUseUpdateEvent;
use Civi\Lughauth\Features\Access\TenantTermsOfUse\Domain\Event\TenantTermsOfUseDeleteEvent;
use Civi\Lughauth\Features\Access\TenantTermsOfUse\Domain\Event\TenantTermsOfUseEnableEvent;
use Civi\Lughauth\Features\Access\TenantTermsOfUse\Domain\Event\TenantTermsOfUseDisableEvent;
use Civi\Lughauth\Features\Access\Tenant\Domain\TenantRef;
use Civi\Lughauth\Shared\Connector\FileStorage\FileStorageInterface;
use Civi\Lughauth\Shared\Connector\FileStorage\FileStoreKey;

class TenantTermsOfUse extends TenantTermsOfUseRef
{
    use TenantTermsOfUseTenantAccesor;
    use TenantTermsOfUseTextAccesor;
    use TenantTermsOfUseEnabledAccesor;
    use TenantTermsOfUseAttachedAccesor;
    use TenantTermsOfUseActivationDateAccesor;
    use TenantTermsOfUseVersionAccesor;
    private array $recordedEvents = [];

    public function __construct(
        TenantTermsOfUseUidVO|string $uid,
        TenantTermsOfUseTenantVO|TenantRef $tenant,
        TenantTermsOfUseTextVO|string $text,
        TenantTermsOfUseEnabledVO|bool $enabled,
        TenantTermsOfUseAttachedVO|string|null $attached = null,
        TenantTermsOfUseActivationDateVO|\DateTimeImmutable|null $activationDate = null,
        TenantTermsOfUseVersionVO|int|null $version = null,
    ) {
        parent::__construct($uid);
        $this->_tenant = TenantTermsOfUseTenantVO::from($tenant);
        $this->_text = TenantTermsOfUseTextVO::from($text);
        $this->_enabled = TenantTermsOfUseEnabledVO::from($enabled);
        $this->_attached = null === $attached ? TenantTermsOfUseAttachedVO::empty() : TenantTermsOfUseAttachedVO::from($attached);
        $this->_activationDate = null === $activationDate ? TenantTermsOfUseActivationDateVO::empty() : TenantTermsOfUseActivationDateVO::from($activationDate);
        $this->_version = null === $version ? TenantTermsOfUseVersionVO::empty() : TenantTermsOfUseVersionVO::from($version);
    }
    public function replace(TenantTermsOfUseAttributes $values): TenantTermsOfUse
    {
        $value = clone $this;
        $value->_tenant = $values->getTenantOrDefault($this->_tenant);
        $value->_text = $values->getTextOrDefault($this->_text);
        $value->_enabled = $values->getEnabledOrDefault($this->_enabled);
        $value->_attached = $values->getAttachedOrDefault($this->_attached);
        $value->_activationDate = $values->getActivationDateOrDefault($this->_activationDate);
        $value->_version = $values->getVersionOrDefault($this->_version);
        return $value;
    }
    public static function calculatedFields(): array
    {
        return [ 'enabled'];
    }
    public static function create(TenantTermsOfUseAttributes $values): TenantTermsOfUse
    {
        $calculated = clone $values;
        $calculated->enabled(EnabledCalculator::calculateEnabled());
        $value = $calculated->build();
        $value->recordedEvents[] = new TenantTermsOfUseCreateEvent($value);
        return $value;
    }
    public function update(TenantTermsOfUseAttributes $values): TenantTermsOfUse
    {
        $calculated = clone $values;
        $calculated->enabled(EnabledCalculator::calculateEnabled($this));
        $value = $this->replace($calculated);
        $value->recordedEvents[] = new TenantTermsOfUseUpdateEvent($value, $this);
        return $value;
    }
    public function delete(): TenantTermsOfUse
    {
        $value = clone $this;
        $value->recordedEvents[] = new TenantTermsOfUseDeleteEvent($value);
        return $value;
    }
    public function commitAttachedWith(FileStorageInterface $store)
    {
        $key = $store->commitContent(new FileStoreKey($this->getAttached()));
        $this->_attached = TenantTermsOfUseAttachedVO::fromStored($key->key);
    }
    public function enable(): TenantTermsOfUse
    {
        $value = clone $this;
        $value->_enabled = TenantTermsOfUseEnabledVO::from(true);
        $value->recordedEvents[] = new TenantTermsOfUseEnableEvent($value, original: $this);
        return $value;
    }
    public function disable(): TenantTermsOfUse
    {
        $value = clone $this;
        $value->_enabled = TenantTermsOfUseEnabledVO::from(false);
        $value->recordedEvents[] = new TenantTermsOfUseDisableEvent($value, original: $this);
        return $value;
    }
    public function asPublicJson(): array
    {
        $data = [];
        $data['uid'] = $this->uid();
        $tenant = $this->getTenant()?->uid();
        if ($tenant) {
            $data['tenant'] = ['$ref' => $tenant];
        }
        $data['enabled'] = $this->isEnabled();
        $data['activationDate'] = $this->getActivationDate();
        $data['version'] = $this->getVersion();
        return $data;
    }
    public function toAttributes(): TenantTermsOfUseAttributes
    {
        return (new TenantTermsOfUseAttributes())
          ->uid($this->uid())
          ->tenant($this->_tenant)
          ->text($this->_text)
          ->enabled($this->_enabled)
          ->attached($this->_attached)
          ->activationDate($this->_activationDate)
          ->version($this->_version);
    }
    public function getTheEvents(): array
    {
        return [...$this->recordedEvents];
    }
}
