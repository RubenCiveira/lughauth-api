<?php

# @autogenerated
declare(strict_types=1);

namespace Civi\Lughauth\Features\Access\TenantTermsOfUse\Infrastructure\Driver;

use Psr\Container\ContainerInterface;
use Override;
use Slim\Routing\RouteCollectorProxy;
use Civi\Lughauth\Features\Access\TenantTermsOfUse\Infrastructure\Driver\Rest\TenantTermsOfUseAllowController;
use Civi\Lughauth\Features\Access\TenantTermsOfUse\Infrastructure\Driver\Rest\TenantTermsOfUseListController;
use Civi\Lughauth\Features\Access\TenantTermsOfUse\Infrastructure\Driver\Rest\TenantTermsOfUseCreateController;
use Civi\Lughauth\Features\Access\TenantTermsOfUse\Infrastructure\Driver\Rest\TenantTermsOfUseRetrieveController;
use Civi\Lughauth\Features\Access\TenantTermsOfUse\Infrastructure\Driver\Rest\TenantTermsOfUseUpdateController;
use Civi\Lughauth\Features\Access\TenantTermsOfUse\Infrastructure\Driver\Rest\TenantTermsOfUseDeleteController;
use Civi\Lughauth\Features\Access\TenantTermsOfUse\Infrastructure\Driver\Rest\TenantTermsOfUseEnableController;
use Civi\Lughauth\Features\Access\TenantTermsOfUse\Infrastructure\Driver\Rest\TenantTermsOfUseDisableController;
use Civi\Lughauth\Features\Access\TenantTermsOfUse\Infrastructure\Driver\Rest\TenantTermsOfUseTempAttachedUploadController;
use Civi\Lughauth\Shared\Security\Rbac\Handler;
use Civi\Lughauth\Shared\Infrastructure\MicroPlugin;
use Civi\Lughauth\Shared\Infrastructure\MicroPlugin\GenericSecurityPlugin;
use Civi\Lughauth\Shared\Infrastructure\StartupProcessor;
use Civi\Lughauth\Shared\Event\EventListenersRegistrarInterface;
use Civi\Lughauth\Features\Access\TenantTermsOfUse\Application\Service\Visibility\TenantTermsOfUseRestrictFilterToVisibility;
use Civi\Lughauth\Features\Access\TenantTermsOfUse\Application\Policy\Filter\TenantAccesible;
use Civi\Lughauth\Features\Access\TenantTermsOfUse\Application\Policy\Fields\TenantTermsOfUseExcludingdRoot;
use Civi\Lughauth\Features\Access\TenantTermsOfUse\Application\Service\Visibility\TenantTermsOfUseCollectNonEditableFields;
use Civi\Lughauth\Features\Access\TenantTermsOfUse\Application\Policy\Allow\Create\IsAutenticatedCreateAllow;
use Civi\Lughauth\Features\Access\TenantTermsOfUse\Application\Usecase\Create\TenantTermsOfUseCreateAllowDecision;
use Civi\Lughauth\Features\Access\TenantTermsOfUse\Application\Policy\Allow\Update\IsAutenticatedUpdateAllow;
use Civi\Lughauth\Features\Access\TenantTermsOfUse\Application\Usecase\Update\TenantTermsOfUseUpdateAllowDecision;
use Civi\Lughauth\Features\Access\TenantTermsOfUse\Application\Policy\Allow\Retrieve\IsAutenticatedRetrieveAllow;
use Civi\Lughauth\Features\Access\TenantTermsOfUse\Application\Usecase\Retrieve\TenantTermsOfUseRetrieveAllowDecision;
use Civi\Lughauth\Features\Access\TenantTermsOfUse\Application\Policy\Allow\List\IsAutenticatedListAllow;
use Civi\Lughauth\Features\Access\TenantTermsOfUse\Application\Usecase\List\TenantTermsOfUseListAllowDecision;
use Civi\Lughauth\Features\Access\TenantTermsOfUse\Application\Policy\Allow\Delete\IsAutenticatedDeleteAllow;
use Civi\Lughauth\Features\Access\TenantTermsOfUse\Application\Usecase\Delete\TenantTermsOfUseDeleteAllowDecision;
use Civi\Lughauth\Features\Access\TenantTermsOfUse\Application\Policy\Allow\Enable\IsAutenticatedEnableAllow;
use Civi\Lughauth\Features\Access\TenantTermsOfUse\Application\Usecase\Enable\TenantTermsOfUseEnableAllowDecision;
use Civi\Lughauth\Features\Access\TenantTermsOfUse\Application\Policy\Allow\Disable\IsAutenticatedDisableAllow;
use Civi\Lughauth\Features\Access\TenantTermsOfUse\Application\Usecase\Disable\TenantTermsOfUseDisableAllowDecision;
use Civi\Lughauth\Features\Access\TenantTermsOfUse\Infrastructure\Driven\TenantTermsOfUseChangelogSync;
use Civi\Lughauth\Shared\Infrastructure\EntityChangeLog\EntityChangeLogSyncEvent;
use Civi\Lughauth\Features\Access\TenantTermsOfUse\Application\Policy\Allow\UploadAttached\IsAutenticatedUploadAttachedAllow;
use Civi\Lughauth\Features\Access\TenantTermsOfUse\Application\Usecase\UploadAttached\TenantTermsOfUseUploadAttachedAllowDecision;

class TenantTermsOfUsePlugin extends MicroPlugin
{
    #[Override]
    public function registerRoutes(RouteCollectorProxy $app)
    {
        $app->group('/api/access/tenants-terms-of-use', [$this, 'setRoutesForTenantTermsOfUse']);
        $app->group('/api/me/acl/access/tenants-terms-of-use', [$this, 'setRoutesForTenantTermsOfUseAcl']);
    }
    #[Override]
    public function registerEvents(EventListenersRegistrarInterface $bus)
    {
        $bus->registerListener(TenantTermsOfUseRestrictFilterToVisibility::class, TenantAccesible::class);
        $bus->registerListener(TenantTermsOfUseCollectNonEditableFields::class, TenantTermsOfUseExcludingdRoot::class);
        $bus->registerListener(TenantTermsOfUseCreateAllowDecision::class, IsAutenticatedCreateAllow::class);
        $bus->registerListener(TenantTermsOfUseUpdateAllowDecision::class, IsAutenticatedUpdateAllow::class);
        $bus->registerListener(TenantTermsOfUseRetrieveAllowDecision::class, IsAutenticatedRetrieveAllow::class);
        $bus->registerListener(TenantTermsOfUseListAllowDecision::class, IsAutenticatedListAllow::class);
        $bus->registerListener(TenantTermsOfUseDeleteAllowDecision::class, IsAutenticatedDeleteAllow::class);
        $bus->registerListener(TenantTermsOfUseEnableAllowDecision::class, IsAutenticatedEnableAllow::class);
        $bus->registerListener(TenantTermsOfUseDisableAllowDecision::class, IsAutenticatedDisableAllow::class);
        $bus->registerListener(EntityChangeLogSyncEvent::class, TenantTermsOfUseChangelogSync::class);
        $bus->registerListener(TenantTermsOfUseUploadAttachedAllowDecision::class, IsAutenticatedUploadAttachedAllow::class);
    }
    #[Override]
    public function registerStartup(StartupProcessor $processor): void
    {
        $processor->register(function (ContainerInterface $container) {
            $handler = $container->get(Handler::class);
            $handler->registerResourceAction("tenant-terms-of-use", "list", "READ");
            $handler->registerResourceAction("tenant-terms-of-use", "create", "WRITE");
            $handler->registerResourceAction("tenant-terms-of-use", "retrieve", "READ");
            $handler->registerResourceAction("tenant-terms-of-use", "update", "WRITE");
            $handler->registerResourceAction("tenant-terms-of-use", "delete", "WRITE");
            $handler->registerResourceAction("tenant-terms-of-use", "enable", "WRITE");
            $handler->registerResourceAction("tenant-terms-of-use", "disable", "WRITE");

            $handler->registerResourceAttribute("tenant-terms-of-use", "tenant", "MANAGE");
            $handler->registerResourceAttribute("tenant-terms-of-use", "text", "MANAGE");
            $handler->registerResourceAttribute("tenant-terms-of-use", "enabled", "MANAGE");
            $handler->registerResourceAttribute("tenant-terms-of-use", "attached", "MANAGE");
            $handler->registerResourceAttribute("tenant-terms-of-use", "activationDate", "MANAGE");
            $handler->registerResourceAttribute("tenant-terms-of-use", "version", "MANAGE");
        }, StartupProcessor::before(GenericSecurityPlugin::STARTUP_ORDER));
    }
    public function setRoutesForTenantTermsOfUseAcl(RouteCollectorProxy $tenantTermsOfUseGroup)
    {
        $tenantTermsOfUseGroup->get('', [TenantTermsOfUseAllowController::class, 'genericAllow']);
        $tenantTermsOfUseGroup->get('/{uid}', [TenantTermsOfUseAllowController::class, 'contextualAllow']);
    }
    public function setRoutesForTenantTermsOfUse(RouteCollectorProxy $tenantTermsOfUseGroup)
    {
        $tenantTermsOfUseGroup->get('', [TenantTermsOfUseListController::class, 'list']);
        $tenantTermsOfUseGroup->post('', [TenantTermsOfUseCreateController::class, 'create']);
        $tenantTermsOfUseGroup->get('/{uid}', [TenantTermsOfUseRetrieveController::class, 'retrieve']);
        $tenantTermsOfUseGroup->get('/{uid}/attached', [TenantTermsOfUseRetrieveController::class, 'retrieveAttached']);
        $tenantTermsOfUseGroup->put('/{uid}', [TenantTermsOfUseUpdateController::class, 'update']);
        $tenantTermsOfUseGroup->delete('/{uid}', [TenantTermsOfUseDeleteController::class, 'delete']);
        $tenantTermsOfUseGroup->delete('', [TenantTermsOfUseDeleteController::class, 'deleteAllForQuery']);
        $tenantTermsOfUseGroup->get('/~/delete-status/{uid}', [TenantTermsOfUseDeleteController::class, 'checkDeleteAllForQueryStatus']);
        $tenantTermsOfUseGroup->patch('/~/enable', [TenantTermsOfUseEnableController::class, 'enableAllForQuery']);
        $tenantTermsOfUseGroup->patch('/{uid}/enable', [TenantTermsOfUseEnableController::class, 'enable']);
        $tenantTermsOfUseGroup->get('/~/enable-status/{uid}', [TenantTermsOfUseEnableController::class, 'checkEnableAllForQueryStatus']);
        $tenantTermsOfUseGroup->patch('/~/disable', [TenantTermsOfUseDisableController::class, 'disableAllForQuery']);
        $tenantTermsOfUseGroup->patch('/{uid}/disable', [TenantTermsOfUseDisableController::class, 'disable']);
        $tenantTermsOfUseGroup->get('/~/disable-status/{uid}', [TenantTermsOfUseDisableController::class, 'checkDisableAllForQueryStatus']);
        $tenantTermsOfUseGroup->post('/-/temp-attached', [TenantTermsOfUseTempAttachedUploadController::class, 'uploadTemp']);
        $tenantTermsOfUseGroup->get('/-/temp-attached', [TenantTermsOfUseTempAttachedUploadController::class, 'getTemp']);
    }
}
