<?php

# @autogenerated
declare(strict_types=1);

namespace Civi\Lughauth\Features\Access\Tenant\Domain;

use Civi\Lughauth\Features\Access\Tenant\Domain\ValueObject\TenantUidVO;
use Civi\Lughauth\Features\Access\Tenant\Domain\ValueObject\TenantNameVO;
use Civi\Lughauth\Features\Access\Tenant\Domain\ValueObject\Accesor\TenantNameAccesor;
use Civi\Lughauth\Features\Access\Tenant\Domain\ValueObject\TenantRootVO;
use Civi\Lughauth\Features\Access\Tenant\Domain\ValueObject\Accesor\TenantRootAccesor;
use Civi\Lughauth\Features\Access\Tenant\Domain\ValueObject\TenantDomainVO;
use Civi\Lughauth\Features\Access\Tenant\Domain\ValueObject\Accesor\TenantDomainAccesor;
use Civi\Lughauth\Features\Access\Tenant\Domain\ValueObject\TenantEnabledVO;
use Civi\Lughauth\Features\Access\Tenant\Domain\ValueObject\Accesor\TenantEnabledAccesor;
use Civi\Lughauth\Features\Access\Tenant\Domain\ValueObject\TenantMarkForDeleteVO;
use Civi\Lughauth\Features\Access\Tenant\Domain\ValueObject\Accesor\TenantMarkForDeleteAccesor;
use Civi\Lughauth\Features\Access\Tenant\Domain\ValueObject\TenantMarkForDeleteTimeVO;
use Civi\Lughauth\Features\Access\Tenant\Domain\ValueObject\Accesor\TenantMarkForDeleteTimeAccesor;
use Civi\Lughauth\Features\Access\Tenant\Domain\ValueObject\TenantVersionVO;
use Civi\Lughauth\Features\Access\Tenant\Domain\ValueObject\Accesor\TenantVersionAccesor;
use Civi\Lughauth\Features\Access\Tenant\Domain\Formula\EnabledCalculator;
use Civi\Lughauth\Features\Access\Tenant\Domain\Formula\MarkForDeleteCalculator;
use Civi\Lughauth\Features\Access\Tenant\Domain\Formula\MarkForDeleteTimeCalculator;
use Civi\Lughauth\Features\Access\Tenant\Domain\Event\TenantCreateEvent;
use Civi\Lughauth\Features\Access\Tenant\Domain\Event\TenantUpdateEvent;
use Civi\Lughauth\Features\Access\Tenant\Domain\Event\TenantDeleteEvent;
use Civi\Lughauth\Features\Access\Tenant\Domain\Event\TenantEnableEvent;
use Civi\Lughauth\Features\Access\Tenant\Domain\Event\TenantDisableEvent;

class Tenant extends TenantRef
{
    use TenantNameAccesor;
    use TenantRootAccesor;
    use TenantDomainAccesor;
    use TenantEnabledAccesor;
    use TenantMarkForDeleteAccesor;
    use TenantMarkForDeleteTimeAccesor;
    use TenantVersionAccesor;
    private array $recordedEvents = [];

    public function __construct(
        TenantUidVO|string $uid,
        TenantNameVO|string $name,
        TenantDomainVO|string $domain,
        TenantEnabledVO|bool $enabled,
        TenantMarkForDeleteVO|bool $markForDelete,
        TenantRootVO|bool|null $root = null,
        TenantMarkForDeleteTimeVO|\DateTimeImmutable|null $markForDeleteTime = null,
        TenantVersionVO|int|null $version = null,
    ) {
        parent::__construct($uid);
        $this->_name = TenantNameVO::from($name);
        $this->_root = null === $root ? TenantRootVO::empty() : TenantRootVO::from($root);
        $this->_domain = TenantDomainVO::from($domain);
        $this->_enabled = TenantEnabledVO::from($enabled);
        $this->_markForDelete = TenantMarkForDeleteVO::from($markForDelete);
        $this->_markForDeleteTime = null === $markForDeleteTime ? TenantMarkForDeleteTimeVO::empty() : TenantMarkForDeleteTimeVO::from($markForDeleteTime);
        $this->_version = null === $version ? TenantVersionVO::empty() : TenantVersionVO::from($version);
    }
    public function replace(TenantAttributes $values): Tenant
    {
        $value = clone $this;
        $value->_name = $values->getNameOrDefault($this->_name);
        $value->_root = $values->getRootOrDefault($this->_root);
        $value->_domain = $values->getDomainOrDefault($this->_domain);
        $value->_enabled = $values->getEnabledOrDefault($this->_enabled);
        $value->_markForDelete = $values->getMarkForDeleteOrDefault($this->_markForDelete);
        $value->_markForDeleteTime = $values->getMarkForDeleteTimeOrDefault($this->_markForDeleteTime);
        $value->_version = $values->getVersionOrDefault($this->_version);
        return $value;
    }
    public static function calculatedFields(): array
    {
        return [ 'enabled', 'markForDelete', 'markForDeleteTime'];
    }
    public static function create(TenantAttributes $values): Tenant
    {
        $calculated = clone $values;
        $calculated->enabled(EnabledCalculator::calculateEnabled());
        $calculated->markForDelete(MarkForDeleteCalculator::calculateMarkForDelete());
        $calculated->markForDeleteTime(MarkForDeleteTimeCalculator::calculateMarkForDeleteTime());
        $value = $calculated->build();
        $value->recordedEvents[] = new TenantCreateEvent($value);
        return $value;
    }
    public function update(TenantAttributes $values): Tenant
    {
        $calculated = clone $values;
        $calculated->enabled(EnabledCalculator::calculateEnabled($this));
        $calculated->markForDelete(MarkForDeleteCalculator::calculateMarkForDelete($this));
        $calculated->markForDeleteTime(MarkForDeleteTimeCalculator::calculateMarkForDeleteTime($this));
        $value = $this->replace($calculated);
        $value->recordedEvents[] = new TenantUpdateEvent($value);
        return $value;
    }
    public function delete(): Tenant
    {
        $value = clone $this;
        $value->recordedEvents[] = new TenantDeleteEvent($value);
        return $value;
    }
    public function enable(): Tenant
    {
        $value = clone $this;
        $value->_enabled = TenantEnabledVO::from(true);
        $value->recordedEvents[] = new TenantEnableEvent(payload: $value);
        return $value;
    }
    public function disable(): Tenant
    {
        $value = clone $this;
        $value->_enabled = TenantEnabledVO::from(false);
        $value->recordedEvents[] = new TenantDisableEvent(payload: $value);
        return $value;
    }
    public function toAttributes(): TenantAttributes
    {
        return (new TenantAttributes())
          ->uid($this->uid())
          ->name($this->_name)
          ->root($this->_root)
          ->domain($this->_domain)
          ->enabled($this->_enabled)
          ->markForDelete($this->_markForDelete)
          ->markForDeleteTime($this->_markForDeleteTime)
          ->version($this->_version);
    }
    public function getTheEvents(): array
    {
        return [...$this->recordedEvents];
    }
}
