<?php

# @autogenerated
declare(strict_types=1);

namespace Civi\Lughauth\Features\Access\UserIdentity\Domain\ValueObject\Holder;

use Civi\Lughauth\Shared\Value\Validation\ConstraintFailList;
use Civi\Lughauth\Features\Access\UserIdentity\Domain\ValueObject\UserIdentityRolesVO;
use Civi\Lughauth\Features\Access\UserIdentity\Domain\ValueObject\UserIdentityRolesListRef;

trait UserIdentityRolesAttributeHolder
{
    protected UserIdentityRolesVO|UserIdentityRolesListRef| array |null $roles = null;
    protected bool $rolesAssigned = false;

    public function getRolesOrDefault(?UserIdentityRolesVO $roles): ?UserIdentityRolesVO
    {
        if ($this->rolesAssigned && $roles) {
            return UserIdentityRolesVO::from($this->roles)->getWithDefaults($roles);
        } elseif ($this->rolesAssigned) {
            return UserIdentityRolesVO::from($this->roles);
        } else {
            return $roles;
        }
    }
    public function roles(UserIdentityRolesVO|UserIdentityRolesListRef| array |null $roles): static
    {
        $this->roles = $roles;
        $this->rolesAssigned = true;
        return $this;
    }
    public function getRoles(): ?UserIdentityRolesListRef
    {
        return is_a($this->roles, UserIdentityRolesVO::class) ? $this->roles->value() : $this->roles;
    }
    public function unsetRoles(): static
    {
        $this->roles = null;
        $this->rolesAssigned = false;
        return $this;
    }
    protected function withDefaultRoles(): void
    {
    }
    protected function withAssertedRolesRules(self $value, ConstraintFailList $errorsList): void
    {
        if ($value->rolesAssigned = $this->rolesAssigned) {
            $value->roles = UserIdentityRolesVO::tryFrom($this->roles, $errorsList);
        }
    }
}
