<?php

# @autogenerated
declare(strict_types=1);

namespace Civi\Lughauth\Features\Access\SecurityDomain\Infrastructure\Driver\Rest;

use Psr\Http\Message\ServerRequestInterface;
use Throwable;
use Civi\Lughauth\Features\Access\SecurityDomain\Domain\ValueObject\SecurityDomainUidVO;
use Civi\Lughauth\Features\Access\SecurityDomain\Domain\ValueObject\SecurityDomainNameVO;
use Civi\Lughauth\Features\Access\SecurityDomain\Domain\ValueObject\SecurityDomainLevelVO;
use Civi\Lughauth\Features\Access\SecurityDomain\Domain\ValueObject\SecurityDomainReadAllVO;
use Civi\Lughauth\Features\Access\SecurityDomain\Domain\ValueObject\SecurityDomainWriteAllVO;
use Civi\Lughauth\Features\Access\SecurityDomain\Domain\ValueObject\SecurityDomainManageAllVO;
use Civi\Lughauth\Features\Access\SecurityDomain\Domain\ValueObject\SecurityDomainVersionVO;
use Civi\Lughauth\Shared\Value\Validation\ConstraintFailList;
use Civi\Lughauth\Features\Access\SecurityDomain\Domain\SecurityDomainAttributes;
use Civi\Lughauth\Shared\Observability\LoggerAwareTrait;
use Civi\Lughauth\Shared\Observability\TracerAwareTrait;

class SecurityDomainRestMapper
{
    use LoggerAwareTrait;
    use TracerAwareTrait;

    public function readSecurityDomain(ServerRequestInterface $request): SecurityDomainAttributes
    {
        $this->logDebug("Read entity for Security domain");
        $span = $this->startSpan("Read entity for Security domain");
        try {
            $body = $request->getParsedBody();
            $dto = new SecurityDomainApiDTO();
            $dto->uid = $body['uid'] ?? null;
            $dto->name = $body['name'] ?? null;
            $dto->level = $body['level'] ?? null;
            $dto->readAll = $body['readAll'] ?? null;
            $dto->writeAll = $body['writeAll'] ?? null;
            $dto->manageAll = $body['manageAll'] ?? null;
            $dto->enabled = $body['enabled'] ?? null;
            $dto->version = $body['version'] ?? null;
            return $this->mapSecurityDomainApiDTO($dto);
        } catch (Throwable $ex) {
            $span->recordException($ex);
            throw $ex;
        } finally {
            $span->end();
        }
    }
    public function mapSecurityDomainApiDTO(SecurityDomainApiDTO $body): SecurityDomainAttributes
    {
        $this->logDebug("Map input dto to entity for Security domain");
        $span = $this->startSpan("Map input dto to entity for Security domain");
        try {
            $errorsList = new ConstraintFailList();
            $value = new SecurityDomainAttributes();
            $value->uid(SecurityDomainUidVO::tryFrom($body->uid ?? null, $errorsList));
            $value->name(SecurityDomainNameVO::tryFrom($body->name ?? null, $errorsList));
            $value->level(SecurityDomainLevelVO::tryFrom($body->level ?? null, $errorsList));
            $value->readAll(SecurityDomainReadAllVO::tryFrom($body->readAll ?? null, $errorsList));
            $value->writeAll(SecurityDomainWriteAllVO::tryFrom($body->writeAll ?? null, $errorsList));
            $value->manageAll(SecurityDomainManageAllVO::tryFrom($body->manageAll ?? null, $errorsList));
            // enabled is a calculated value, we cant read it
            $value->version(SecurityDomainVersionVO::tryFrom($body->version ?? null, $errorsList));
            if ($errorsList->hasErrors()) {
                throw $errorsList->asConstraintException();
            }
            return $value;
        } catch (Throwable $ex) {
            $span->recordException($ex);
            throw $ex;
        } finally {
            $span->end();
        }
    }
    public function mapSecurityDomain(SecurityDomainAttributes $value): SecurityDomainApiDTO
    {
        $this->logDebug("Map entity to output dto for Security domain");
        $span = $this->startSpan("Map entity to output dto for Security domain");
        try {
            $dto = new SecurityDomainApiDTO();
            $dto->uid = $value->getUid();
            $dto->name = $value->getName();
            $dto->level = $value->getLevel();
            $dto->readAll = $value->getReadAll();
            $dto->writeAll = $value->getWriteAll();
            $dto->manageAll = $value->getManageAll();
            $dto->enabled = $value->getEnabled();
            $dto->version = $value->getVersion();
            return $dto;
        } catch (Throwable $ex) {
            $span->recordException($ex);
            throw $ex;
        } finally {
            $span->end();
        }
    }
}
