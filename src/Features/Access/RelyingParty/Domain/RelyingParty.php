<?php

# @autogenerated
declare(strict_types=1);

namespace Civi\Lughauth\Features\Access\RelyingParty\Domain;

use Civi\Lughauth\Features\Access\RelyingParty\Domain\ValueObject\RelyingPartyUidVO;
use Civi\Lughauth\Features\Access\RelyingParty\Domain\ValueObject\RelyingPartyCodeVO;
use Civi\Lughauth\Features\Access\RelyingParty\Domain\ValueObject\Accesor\RelyingPartyCodeAccesor;
use Civi\Lughauth\Features\Access\RelyingParty\Domain\ValueObject\RelyingPartyApiKeyVO;
use Civi\Lughauth\Features\Access\RelyingParty\Domain\ValueObject\Accesor\RelyingPartyApiKeyAccesor;
use Civi\Lughauth\Features\Access\RelyingParty\Domain\ValueObject\RelyingPartyEnabledVO;
use Civi\Lughauth\Features\Access\RelyingParty\Domain\ValueObject\Accesor\RelyingPartyEnabledAccesor;
use Civi\Lughauth\Features\Access\RelyingParty\Domain\ValueObject\RelyingPartyScopesVO;
use Civi\Lughauth\Features\Access\RelyingParty\Domain\ValueObject\Accesor\RelyingPartyScopesAccesor;
use Civi\Lughauth\Features\Access\RelyingParty\Domain\ValueObject\RelyingPartySchemasVO;
use Civi\Lughauth\Features\Access\RelyingParty\Domain\ValueObject\Accesor\RelyingPartySchemasAccesor;
use Civi\Lughauth\Features\Access\RelyingParty\Domain\ValueObject\RelyingPartyPoliciesVO;
use Civi\Lughauth\Features\Access\RelyingParty\Domain\ValueObject\Accesor\RelyingPartyPoliciesAccesor;
use Civi\Lughauth\Features\Access\RelyingParty\Domain\ValueObject\RelyingPartyVersionVO;
use Civi\Lughauth\Features\Access\RelyingParty\Domain\ValueObject\Accesor\RelyingPartyVersionAccesor;
use Civi\Lughauth\Features\Access\RelyingParty\Domain\Formula\EnabledCalculator;
use Civi\Lughauth\Features\Access\RelyingParty\Domain\Formula\ScopesCalculator;
use Civi\Lughauth\Features\Access\RelyingParty\Domain\Formula\SchemasCalculator;
use Civi\Lughauth\Features\Access\RelyingParty\Domain\Event\RelyingPartyCreateEvent;
use Civi\Lughauth\Features\Access\RelyingParty\Domain\Event\RelyingPartyUpdateEvent;
use Civi\Lughauth\Features\Access\RelyingParty\Domain\Event\RelyingPartyDeleteEvent;
use Civi\Lughauth\Features\Access\RelyingParty\Domain\Event\RelyingPartyEnableEvent;
use Civi\Lughauth\Features\Access\RelyingParty\Domain\Event\RelyingPartyDisableEvent;

class RelyingParty extends RelyingPartyRef
{
    use RelyingPartyCodeAccesor;
    use RelyingPartyApiKeyAccesor;
    use RelyingPartyEnabledAccesor;
    use RelyingPartyScopesAccesor;
    use RelyingPartySchemasAccesor;
    use RelyingPartyPoliciesAccesor;
    use RelyingPartyVersionAccesor;
    private array $recordedEvents = [];

    public function __construct(
        RelyingPartyUidVO|string $uid,
        RelyingPartyCodeVO|string $code,
        RelyingPartyApiKeyVO|string $apiKey,
        RelyingPartyScopesVO|string $scopes,
        RelyingPartySchemasVO|string $schemas,
        RelyingPartyEnabledVO|bool|null $enabled = null,
        RelyingPartyPoliciesVO|string|null $policies = null,
        RelyingPartyVersionVO|int|null $version = null,
    ) {
        parent::__construct($uid);
        $this->_code = RelyingPartyCodeVO::from($code);
        $this->_apiKey = RelyingPartyApiKeyVO::from($apiKey);
        $this->_enabled = null === $enabled ? RelyingPartyEnabledVO::empty() : RelyingPartyEnabledVO::from($enabled);
        $this->_scopes = RelyingPartyScopesVO::from($scopes);
        $this->_schemas = RelyingPartySchemasVO::from($schemas);
        $this->_policies = null === $policies ? RelyingPartyPoliciesVO::empty() : RelyingPartyPoliciesVO::from($policies);
        $this->_version = null === $version ? RelyingPartyVersionVO::empty() : RelyingPartyVersionVO::from($version);
    }
    public function replace(RelyingPartyAttributes $values): RelyingParty
    {
        $value = clone $this;
        $value->_code = $values->getCodeOrDefault($this->_code);
        $value->_apiKey = $values->getApiKeyOrDefault($this->_apiKey);
        $value->_enabled = $values->getEnabledOrDefault($this->_enabled);
        $value->_scopes = $values->getScopesOrDefault($this->_scopes);
        $value->_schemas = $values->getSchemasOrDefault($this->_schemas);
        $value->_policies = $values->getPoliciesOrDefault($this->_policies);
        $value->_version = $values->getVersionOrDefault($this->_version);
        return $value;
    }
    public static function calculatedFields(): array
    {
        return [ 'enabled', 'scopes', 'schemas'];
    }
    public static function create(RelyingPartyAttributes $values): RelyingParty
    {
        $calculated = clone $values;
        $calculated->enabled(EnabledCalculator::calculateEnabled());
        $calculated->scopes(ScopesCalculator::calculateScopes());
        $calculated->schemas(SchemasCalculator::calculateSchemas());
        $value = $calculated->build();
        $value->recordedEvents[] = new RelyingPartyCreateEvent($value);
        return $value;
    }
    public function update(RelyingPartyAttributes $values): RelyingParty
    {
        $calculated = clone $values;
        $calculated->enabled(EnabledCalculator::calculateEnabled($this));
        $calculated->scopes(ScopesCalculator::calculateScopes($this));
        $calculated->schemas(SchemasCalculator::calculateSchemas($this));
        $value = $this->replace($calculated);
        $value->recordedEvents[] = new RelyingPartyUpdateEvent($value, $this);
        return $value;
    }
    public function delete(): RelyingParty
    {
        $value = clone $this;
        $value->recordedEvents[] = new RelyingPartyDeleteEvent($value);
        return $value;
    }
    public function enable(): RelyingParty
    {
        $value = clone $this;
        $value->_enabled = RelyingPartyEnabledVO::from(true);
        $value->recordedEvents[] = new RelyingPartyEnableEvent(payload: $value, original: $this);
        return $value;
    }
    public function disable(): RelyingParty
    {
        $value = clone $this;
        $value->_enabled = RelyingPartyEnabledVO::from(false);
        $value->recordedEvents[] = new RelyingPartyDisableEvent(payload: $value, original: $this);
        return $value;
    }
    public function asPublicJson(): array
    {
        $data = [];
        $data['uid'] = $this->uid();
        $data['code'] = $this->getCode();
        $data['apiKey'] = $this->getApiKey();
        $data['enabled'] = $this->getEnabled();
        $data['version'] = $this->getVersion();
        return $data;
    }
    public function toAttributes(): RelyingPartyAttributes
    {
        return (new RelyingPartyAttributes())
          ->uid($this->uid())
          ->code($this->_code)
          ->apiKey($this->_apiKey)
          ->enabled($this->_enabled)
          ->scopes($this->_scopes)
          ->schemas($this->_schemas)
          ->policies($this->_policies)
          ->version($this->_version);
    }
    public function getTheEvents(): array
    {
        return [...$this->recordedEvents];
    }
}
