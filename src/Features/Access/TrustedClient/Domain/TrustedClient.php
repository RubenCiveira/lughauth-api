<?php

# @autogenerated
declare(strict_types=1);

namespace Civi\Lughauth\Features\Access\TrustedClient\Domain;

use Civi\Lughauth\Features\Access\TrustedClient\Domain\ValueObject\TrustedClientUidVO;
use Civi\Lughauth\Features\Access\TrustedClient\Domain\ValueObject\TrustedClientCodeVO;
use Civi\Lughauth\Features\Access\TrustedClient\Domain\ValueObject\Accesor\TrustedClientCodeAccesor;
use Civi\Lughauth\Features\Access\TrustedClient\Domain\ValueObject\TrustedClientPublicAllowVO;
use Civi\Lughauth\Features\Access\TrustedClient\Domain\ValueObject\Accesor\TrustedClientPublicAllowAccesor;
use Civi\Lughauth\Features\Access\TrustedClient\Domain\ValueObject\TrustedClientSecretOauthVO;
use Civi\Lughauth\Features\Access\TrustedClient\Domain\ValueObject\Accesor\TrustedClientSecretOauthAccesor;
use Civi\Lughauth\Features\Access\TrustedClient\Domain\ValueObject\TrustedClientEnabledVO;
use Civi\Lughauth\Features\Access\TrustedClient\Domain\ValueObject\Accesor\TrustedClientEnabledAccesor;
use Civi\Lughauth\Features\Access\TrustedClient\Domain\ValueObject\TrustedClientAllowedRedirectsListRef;
use Civi\Lughauth\Features\Access\TrustedClient\Domain\ValueObject\TrustedClientAllowedRedirectsVO;
use Civi\Lughauth\Features\Access\TrustedClient\Domain\ValueObject\Accesor\TrustedClientAllowedRedirectsAccesor;
use Civi\Lughauth\Features\Access\TrustedClient\Domain\ValueObject\TrustedClientVersionVO;
use Civi\Lughauth\Features\Access\TrustedClient\Domain\ValueObject\Accesor\TrustedClientVersionAccesor;
use Civi\Lughauth\Features\Access\TrustedClient\Domain\Formula\EnabledCalculator;
use Civi\Lughauth\Features\Access\TrustedClient\Domain\Event\TrustedClientCreateEvent;
use Civi\Lughauth\Features\Access\TrustedClient\Domain\Event\TrustedClientUpdateEvent;
use Civi\Lughauth\Features\Access\TrustedClient\Domain\Event\TrustedClientDeleteEvent;
use Civi\Lughauth\Features\Access\TrustedClient\Domain\Event\TrustedClientEnableEvent;
use Civi\Lughauth\Features\Access\TrustedClient\Domain\Event\TrustedClientDisableEvent;

class TrustedClient extends TrustedClientRef
{
    use TrustedClientCodeAccesor;
    use TrustedClientPublicAllowAccesor;
    use TrustedClientSecretOauthAccesor;
    use TrustedClientEnabledAccesor;
    use TrustedClientAllowedRedirectsAccesor;
    use TrustedClientVersionAccesor;
    private array $recordedEvents = [];

    public function __construct(
        TrustedClientUidVO|string $uid,
        TrustedClientCodeVO|string $code,
        TrustedClientPublicAllowVO|bool $publicAllow,
        TrustedClientEnabledVO|bool $enabled,
        TrustedClientAllowedRedirectsVO|TrustedClientAllowedRedirectsListRef| array |null $allowedRedirects,
        TrustedClientSecretOauthVO|string|null $secretOauth = null,
        TrustedClientVersionVO|int|null $version = null,
    ) {
        parent::__construct($uid);
        $this->_code = TrustedClientCodeVO::from($code);
        $this->_publicAllow = TrustedClientPublicAllowVO::from($publicAllow);
        $this->_secretOauth = null === $secretOauth ? TrustedClientSecretOauthVO::empty() : TrustedClientSecretOauthVO::from($secretOauth);
        $this->_enabled = TrustedClientEnabledVO::from($enabled);
        $this->_allowedRedirects = TrustedClientAllowedRedirectsVO::from($allowedRedirects);
        $this->_version = null === $version ? TrustedClientVersionVO::empty() : TrustedClientVersionVO::from($version);
    }
    public function replace(TrustedClientAttributes $values): TrustedClient
    {
        $value = clone $this;
        $value->_code = $values->getCodeOrDefault($this->_code);
        $value->_publicAllow = $values->getPublicAllowOrDefault($this->_publicAllow);
        $value->_secretOauth = $values->getSecretOauthOrDefault($this->_secretOauth);
        $value->_enabled = $values->getEnabledOrDefault($this->_enabled);
        $value->_allowedRedirects = $values->getAllowedRedirectsOrDefault($this->_allowedRedirects);
        $value->_version = $values->getVersionOrDefault($this->_version);
        return $value;
    }
    public static function calculatedFields(): array
    {
        return [ 'enabled'];
    }
    public static function create(TrustedClientAttributes $values): TrustedClient
    {
        $calculated = clone $values;
        $calculated->enabled(EnabledCalculator::calculateEnabled());
        $value = $calculated->build();
        $value->recordedEvents[] = new TrustedClientCreateEvent($value);
        return $value;
    }
    public function update(TrustedClientAttributes $values): TrustedClient
    {
        $calculated = clone $values;
        $calculated->enabled(EnabledCalculator::calculateEnabled($this));
        $value = $this->replace($calculated);
        $value->recordedEvents[] = new TrustedClientUpdateEvent($value);
        return $value;
    }
    public function delete(): TrustedClient
    {
        $value = clone $this;
        $value->recordedEvents[] = new TrustedClientDeleteEvent($value);
        return $value;
    }
    public function enable(): TrustedClient
    {
        $value = clone $this;
        $value->_enabled = TrustedClientEnabledVO::from(true);
        $value->recordedEvents[] = new TrustedClientEnableEvent($value);
        return $value;
    }
    public function disable(): TrustedClient
    {
        $value = clone $this;
        $value->_enabled = TrustedClientEnabledVO::from(false);
        $value->recordedEvents[] = new TrustedClientDisableEvent($value);
        return $value;
    }
    public function toAttributes(): TrustedClientAttributes
    {
        return (new TrustedClientAttributes())
          ->uid($this->uid())
          ->code($this->_code)
          ->publicAllow($this->_publicAllow)
          ->secretOauth($this->_secretOauth)
          ->enabled($this->_enabled)
          ->allowedRedirects($this->_allowedRedirects)
          ->version($this->_version);
    }
    public function getTheEvents(): array
    {
        return [...$this->recordedEvents];
    }
}
