<?php

# @autogenerated
declare(strict_types=1);

namespace Civi\Lughauth\Features\Access\Master\Role\Domain;

use Civi\Lughauth\Features\Access\Master\Role\Domain\ValueObject\RoleUidVO;
use Civi\Lughauth\Features\Access\Master\Role\Domain\ValueObject\RoleNameVO;
use Civi\Lughauth\Features\Access\Master\Role\Domain\ValueObject\Accesor\RoleNameAccesor;
use Civi\Lughauth\Features\Access\Master\Role\Domain\ValueObject\RoleTenantVO;
use Civi\Lughauth\Features\Access\Master\Role\Domain\ValueObject\Accesor\RoleTenantAccesor;
use Civi\Lughauth\Features\Access\Master\Role\Domain\ValueObject\RoleVersionVO;
use Civi\Lughauth\Features\Access\Master\Role\Domain\ValueObject\Accesor\RoleVersionAccesor;
use Civi\Lughauth\Features\Access\Master\Role\Domain\Event\RoleCreateEvent;
use Civi\Lughauth\Features\Access\Master\Role\Domain\Event\RoleUpdateEvent;
use Civi\Lughauth\Features\Access\Master\Role\Domain\Event\RoleDeleteEvent;
use Civi\Lughauth\Features\Access\Master\Tenant\Domain\TenantRef;

class Role extends RoleRef
{
    use RoleNameAccesor;
    use RoleTenantAccesor;
    use RoleVersionAccesor;
    private array $recordedEvents = [];

    public function __construct(
        RoleUidVO|string $uid,
        RoleNameVO|string $name,
        RoleTenantVO|TenantRef|null $tenant = null,
        RoleVersionVO|int|null $version = null,
    ) {
        parent::__construct($uid);
        $this->_name = RoleNameVO::from($name);
        $this->_tenant = null === $tenant ? RoleTenantVO::empty() : RoleTenantVO::from($tenant);
        $this->_version = null === $version ? RoleVersionVO::empty() : RoleVersionVO::from($version);
    }
    public function replace(RoleAttributes $values): Role
    {
        $value = clone $this;
        $value->_name = $values->getNameOrDefault($this->_name);
        $value->_tenant = $values->getTenantOrDefault($this->_tenant);
        $value->_version = $values->getVersionOrDefault($this->_version);
        return $value;
    }
    public static function calculatedFields(): array
    {
        return [];
    }
    public static function create(RoleAttributes $values): Role
    {
        $value = $values->build();
        $value->recordedEvents[] = new RoleCreateEvent($value);
        return $value;
    }
    public function update(RoleAttributes $values): Role
    {
        $value = $this->replace($values);
        $value->recordedEvents[] = new RoleUpdateEvent($value, $this);
        return $value;
    }
    public function delete(): Role
    {
        $value = clone $this;
        $value->recordedEvents[] = new RoleDeleteEvent($value);
        return $value;
    }
    public function asPublicJson(): array
    {
        $data = [];
        $data['uid'] = $this->uid();
        $data['name'] = $this->getName();
        $tenant = $this->getTenant()?->uid();
        if ($tenant) {
            $data['tenant'] = ['$ref' => $tenant];
        }
        $data['version'] = $this->getVersion();
        return $data;
    }
    public function toAttributes(): RoleAttributes
    {
        return (new RoleAttributes())
          ->uid($this->uid())
          ->name($this->_name)
          ->tenant($this->_tenant)
          ->version($this->_version);
    }
    public function getTheEvents(): array
    {
        return [...$this->recordedEvents];
    }
}
