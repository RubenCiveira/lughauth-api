<?php

# @autogenerated
declare(strict_types=1);

namespace Civi\Lughauth\Features\Access\Master\ApiKeyClient\Domain;

use Civi\Lughauth\Features\Access\Master\ApiKeyClient\Domain\ValueObject\ApiKeyClientUidVO;
use Civi\Lughauth\Features\Access\Master\ApiKeyClient\Domain\ValueObject\ApiKeyClientCodeVO;
use Civi\Lughauth\Features\Access\Master\ApiKeyClient\Domain\ValueObject\Accesor\ApiKeyClientCodeAccesor;
use Civi\Lughauth\Features\Access\Master\ApiKeyClient\Domain\ValueObject\ApiKeyClientKeyVO;
use Civi\Lughauth\Features\Access\Master\ApiKeyClient\Domain\ValueObject\Accesor\ApiKeyClientKeyAccesor;
use Civi\Lughauth\Features\Access\Master\ApiKeyClient\Domain\ValueObject\ApiKeyClientEnabledVO;
use Civi\Lughauth\Features\Access\Master\ApiKeyClient\Domain\ValueObject\Accesor\ApiKeyClientEnabledAccesor;
use Civi\Lughauth\Features\Access\Master\ApiKeyClient\Domain\ValueObject\ApiKeyClientScopesVO;
use Civi\Lughauth\Features\Access\Master\ApiKeyClient\Domain\ValueObject\Accesor\ApiKeyClientScopesAccesor;
use Civi\Lughauth\Features\Access\Master\ApiKeyClient\Domain\ValueObject\ApiKeyClientVersionVO;
use Civi\Lughauth\Features\Access\Master\ApiKeyClient\Domain\ValueObject\Accesor\ApiKeyClientVersionAccesor;
use Civi\Lughauth\Features\Access\Master\ApiKeyClient\Domain\Formula\EnabledCalculator;
use Civi\Lughauth\Features\Access\Master\ApiKeyClient\Domain\Event\ApiKeyClientCreateEvent;
use Civi\Lughauth\Features\Access\Master\ApiKeyClient\Domain\Event\ApiKeyClientUpdateEvent;
use Civi\Lughauth\Features\Access\Master\ApiKeyClient\Domain\Event\ApiKeyClientDeleteEvent;
use Civi\Lughauth\Features\Access\Master\ApiKeyClient\Domain\Event\ApiKeyClientEnableEvent;
use Civi\Lughauth\Features\Access\Master\ApiKeyClient\Domain\Event\ApiKeyClientDisableEvent;

class ApiKeyClient extends ApiKeyClientRef
{
    use ApiKeyClientCodeAccesor;
    use ApiKeyClientKeyAccesor;
    use ApiKeyClientEnabledAccesor;
    use ApiKeyClientScopesAccesor;
    use ApiKeyClientVersionAccesor;
    private array $recordedEvents = [];

    public function __construct(
        ApiKeyClientUidVO|string $uid,
        ApiKeyClientCodeVO|string $code,
        ApiKeyClientEnabledVO|bool $enabled,
        ApiKeyClientKeyVO|string|null $key = null,
        ApiKeyClientScopesVO|string|null $scopes = null,
        ApiKeyClientVersionVO|int|null $version = null,
    ) {
        parent::__construct($uid);
        $this->_code = ApiKeyClientCodeVO::from($code);
        $this->_key = null === $key ? ApiKeyClientKeyVO::empty() : ApiKeyClientKeyVO::from($key);
        $this->_enabled = ApiKeyClientEnabledVO::from($enabled);
        $this->_scopes = null === $scopes ? ApiKeyClientScopesVO::empty() : ApiKeyClientScopesVO::from($scopes);
        $this->_version = null === $version ? ApiKeyClientVersionVO::empty() : ApiKeyClientVersionVO::from($version);
    }
    public function replace(ApiKeyClientAttributes $values): ApiKeyClient
    {
        $value = clone $this;
        $value->_code = $values->getCodeOrDefault($this->_code);
        $value->_key = $values->getKeyOrDefault($this->_key);
        $value->_enabled = $values->getEnabledOrDefault($this->_enabled);
        $value->_scopes = $values->getScopesOrDefault($this->_scopes);
        $value->_version = $values->getVersionOrDefault($this->_version);
        return $value;
    }
    public static function calculatedFields(): array
    {
        return [ 'enabled'];
    }
    public static function create(ApiKeyClientAttributes $values): ApiKeyClient
    {
        $calculated = clone $values;
        $calculated->enabled(EnabledCalculator::calculateEnabled());
        $value = $calculated->build();
        $value->recordedEvents[] = new ApiKeyClientCreateEvent($value);
        return $value;
    }
    public function update(ApiKeyClientAttributes $values): ApiKeyClient
    {
        $calculated = clone $values;
        $calculated->enabled(EnabledCalculator::calculateEnabled($this));
        $value = $this->replace($calculated);
        $value->recordedEvents[] = new ApiKeyClientUpdateEvent($value, $this);
        return $value;
    }
    public function delete(): ApiKeyClient
    {
        $value = clone $this;
        $value->recordedEvents[] = new ApiKeyClientDeleteEvent($value);
        return $value;
    }
    public function enable(): ApiKeyClient
    {
        $value = clone $this;
        $value->_enabled = ApiKeyClientEnabledVO::from(true);
        $value->recordedEvents[] = new ApiKeyClientEnableEvent($value, original: $this);
        return $value;
    }
    public function disable(): ApiKeyClient
    {
        $value = clone $this;
        $value->_enabled = ApiKeyClientEnabledVO::from(false);
        $value->recordedEvents[] = new ApiKeyClientDisableEvent($value, original: $this);
        return $value;
    }
    public function asPublicJson(): array
    {
        $data = [];
        $data['uid'] = $this->uid();
        $data['code'] = $this->getCode();
        $data['key'] = $this->getKey();
        $data['enabled'] = $this->isEnabled();
        $data['scopes'] = $this->getScopes();
        $data['version'] = $this->getVersion();
        return $data;
    }
    public function toAttributes(): ApiKeyClientAttributes
    {
        return (new ApiKeyClientAttributes())
          ->uid($this->uid())
          ->code($this->_code)
          ->key($this->_key)
          ->enabled($this->_enabled)
          ->scopes($this->_scopes)
          ->version($this->_version);
    }
    public function getTheEvents(): array
    {
        return [...$this->recordedEvents];
    }
}
