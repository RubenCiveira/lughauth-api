<?php

# @autogenerated
declare(strict_types=1);

namespace Civi\Lughauth\Features\Access\SecurityAttribute\Domain;

use Civi\Lughauth\Features\Access\SecurityAttribute\Domain\ValueObject\SecurityAttributeUidVO;
use Civi\Lughauth\Features\Access\SecurityAttribute\Domain\ValueObject\SecurityAttributeTrustedClientVO;
use Civi\Lughauth\Features\Access\SecurityAttribute\Domain\ValueObject\Accesor\SecurityAttributeTrustedClientAccesor;
use Civi\Lughauth\Features\Access\SecurityAttribute\Domain\ValueObject\SecurityAttributeRelyingPartyVO;
use Civi\Lughauth\Features\Access\SecurityAttribute\Domain\ValueObject\Accesor\SecurityAttributeRelyingPartyAccesor;
use Civi\Lughauth\Features\Access\SecurityAttribute\Domain\ValueObject\SecurityAttributeResourceVO;
use Civi\Lughauth\Features\Access\SecurityAttribute\Domain\ValueObject\Accesor\SecurityAttributeResourceAccesor;
use Civi\Lughauth\Features\Access\SecurityAttribute\Domain\ValueObject\SecurityAttributeAttributeVO;
use Civi\Lughauth\Features\Access\SecurityAttribute\Domain\ValueObject\Accesor\SecurityAttributeAttributeAccesor;
use Civi\Lughauth\Features\Access\SecurityAttribute\Domain\ValueObject\SecurityAttributeEnabledVO;
use Civi\Lughauth\Features\Access\SecurityAttribute\Domain\ValueObject\Accesor\SecurityAttributeEnabledAccesor;
use Civi\Lughauth\Features\Access\SecurityAttribute\Domain\ValueObject\SecurityAttributeReadVisibilityVO;
use Civi\Lughauth\Features\Access\SecurityAttribute\Domain\ValueObject\Accesor\SecurityAttributeReadVisibilityAccesor;
use Civi\Lughauth\Features\Access\SecurityAttribute\Domain\ValueObject\SecurityAttributeWriteVisibilityVO;
use Civi\Lughauth\Features\Access\SecurityAttribute\Domain\ValueObject\Accesor\SecurityAttributeWriteVisibilityAccesor;
use Civi\Lughauth\Features\Access\SecurityAttribute\Domain\ValueObject\SecurityAttributeVersionVO;
use Civi\Lughauth\Features\Access\SecurityAttribute\Domain\ValueObject\Accesor\SecurityAttributeVersionAccesor;
use Civi\Lughauth\Features\Access\SecurityAttribute\Domain\Formula\EnabledCalculator;
use Civi\Lughauth\Features\Access\SecurityAttribute\Domain\Event\SecurityAttributeCreateEvent;
use Civi\Lughauth\Features\Access\SecurityAttribute\Domain\Event\SecurityAttributeUpdateEvent;
use Civi\Lughauth\Features\Access\SecurityAttribute\Domain\Event\SecurityAttributeDeleteEvent;
use Civi\Lughauth\Features\Access\SecurityAttribute\Domain\Event\SecurityAttributeDisableEvent;
use Civi\Lughauth\Features\Access\SecurityAttribute\Domain\Event\SecurityAttributeEnableEvent;
use Civi\Lughauth\Features\Access\TrustedClient\Domain\TrustedClientRef;
use Civi\Lughauth\Features\Access\RelyingParty\Domain\RelyingPartyRef;

class SecurityAttribute extends SecurityAttributeRef
{
    use SecurityAttributeTrustedClientAccesor;
    use SecurityAttributeRelyingPartyAccesor;
    use SecurityAttributeResourceAccesor;
    use SecurityAttributeAttributeAccesor;
    use SecurityAttributeEnabledAccesor;
    use SecurityAttributeReadVisibilityAccesor;
    use SecurityAttributeWriteVisibilityAccesor;
    use SecurityAttributeVersionAccesor;
    private array $recordedEvents = [];

    public function __construct(
        SecurityAttributeUidVO|string $uid,
        SecurityAttributeResourceVO|string $resource,
        SecurityAttributeAttributeVO|string $attribute,
        SecurityAttributeTrustedClientVO|TrustedClientRef|null $trustedClient = null,
        SecurityAttributeRelyingPartyVO|RelyingPartyRef|null $relyingParty = null,
        SecurityAttributeEnabledVO|bool|null $enabled = null,
        SecurityAttributeReadVisibilityVO|string|null $readVisibility = null,
        SecurityAttributeWriteVisibilityVO|string|null $writeVisibility = null,
        SecurityAttributeVersionVO|int|null $version = null,
    ) {
        parent::__construct($uid);
        $this->_trustedClient = null === $trustedClient ? SecurityAttributeTrustedClientVO::empty() : SecurityAttributeTrustedClientVO::from($trustedClient);
        $this->_relyingParty = null === $relyingParty ? SecurityAttributeRelyingPartyVO::empty() : SecurityAttributeRelyingPartyVO::from($relyingParty);
        $this->_resource = SecurityAttributeResourceVO::from($resource);
        $this->_attribute = SecurityAttributeAttributeVO::from($attribute);
        $this->_enabled = null === $enabled ? SecurityAttributeEnabledVO::empty() : SecurityAttributeEnabledVO::from($enabled);
        $this->_readVisibility = null === $readVisibility ? SecurityAttributeReadVisibilityVO::empty() : SecurityAttributeReadVisibilityVO::from($readVisibility);
        $this->_writeVisibility = null === $writeVisibility ? SecurityAttributeWriteVisibilityVO::empty() : SecurityAttributeWriteVisibilityVO::from($writeVisibility);
        $this->_version = null === $version ? SecurityAttributeVersionVO::empty() : SecurityAttributeVersionVO::from($version);
    }
    public function replace(SecurityAttributeAttributes $values): SecurityAttribute
    {
        $value = clone $this;
        $value->_trustedClient = $values->getTrustedClientOrDefault($this->_trustedClient);
        $value->_relyingParty = $values->getRelyingPartyOrDefault($this->_relyingParty);
        $value->_resource = $values->getResourceOrDefault($this->_resource);
        $value->_attribute = $values->getAttributeOrDefault($this->_attribute);
        $value->_enabled = $values->getEnabledOrDefault($this->_enabled);
        $value->_readVisibility = $values->getReadVisibilityOrDefault($this->_readVisibility);
        $value->_writeVisibility = $values->getWriteVisibilityOrDefault($this->_writeVisibility);
        $value->_version = $values->getVersionOrDefault($this->_version);
        return $value;
    }
    public static function calculatedFields(): array
    {
        return [ 'enabled'];
    }
    public static function create(SecurityAttributeAttributes $values): SecurityAttribute
    {
        $calculated = clone $values;
        $calculated->enabled(EnabledCalculator::calculateEnabled());
        $value = $calculated->build();
        $value->recordedEvents[] = new SecurityAttributeCreateEvent($value);
        return $value;
    }
    public function update(SecurityAttributeAttributes $values): SecurityAttribute
    {
        $calculated = clone $values;
        $calculated->enabled(EnabledCalculator::calculateEnabled($this));
        $value = $this->replace($calculated);
        $value->recordedEvents[] = new SecurityAttributeUpdateEvent($value);
        return $value;
    }
    public function delete(): SecurityAttribute
    {
        $value = clone $this;
        $value->recordedEvents[] = new SecurityAttributeDeleteEvent($value);
        return $value;
    }
    public function disable(): SecurityAttribute
    {
        $value = clone $this;
        $value->_enabled = SecurityAttributeEnabledVO::from(false);
        $value->recordedEvents[] = new SecurityAttributeDisableEvent(payload: $value);
        return $value;
    }
    public function enable(): SecurityAttribute
    {
        $value = clone $this;
        $value->_enabled = SecurityAttributeEnabledVO::from(true);
        $value->recordedEvents[] = new SecurityAttributeEnableEvent(payload: $value);
        return $value;
    }
    public function toAttributes(): SecurityAttributeAttributes
    {
        return (new SecurityAttributeAttributes())
          ->uid($this->uid())
          ->trustedClient($this->_trustedClient)
          ->relyingParty($this->_relyingParty)
          ->resource($this->_resource)
          ->attribute($this->_attribute)
          ->enabled($this->_enabled)
          ->readVisibility($this->_readVisibility)
          ->writeVisibility($this->_writeVisibility)
          ->version($this->_version);
    }
    public function getTheEvents(): array
    {
        return [...$this->recordedEvents];
    }
}
