<?php

# @autogenerated
declare(strict_types=1);

namespace Civi\Lughauth\Features\Access\TenantLoginProvider\Domain;

use Civi\Lughauth\Features\Access\TenantLoginProvider\Domain\ValueObject\TenantLoginProviderUidVO;
use Civi\Lughauth\Features\Access\TenantLoginProvider\Domain\ValueObject\TenantLoginProviderTenantVO;
use Civi\Lughauth\Features\Access\TenantLoginProvider\Domain\ValueObject\Accesor\TenantLoginProviderTenantAccesor;
use Civi\Lughauth\Features\Access\TenantLoginProvider\Domain\ValueObject\TenantLoginProviderNameVO;
use Civi\Lughauth\Features\Access\TenantLoginProvider\Domain\ValueObject\Accesor\TenantLoginProviderNameAccesor;
use Civi\Lughauth\Features\Access\TenantLoginProvider\Domain\ValueObject\TenantLoginProviderSourceVO;
use Civi\Lughauth\Features\Access\TenantLoginProvider\Domain\ValueObject\Accesor\TenantLoginProviderSourceAccesor;
use Civi\Lughauth\Features\Access\TenantLoginProvider\Domain\ValueObject\TenantLoginProviderDisabledVO;
use Civi\Lughauth\Features\Access\TenantLoginProvider\Domain\ValueObject\Accesor\TenantLoginProviderDisabledAccesor;
use Civi\Lughauth\Features\Access\TenantLoginProvider\Domain\ValueObject\TenantLoginProviderDirectAccessVO;
use Civi\Lughauth\Features\Access\TenantLoginProvider\Domain\ValueObject\Accesor\TenantLoginProviderDirectAccessAccesor;
use Civi\Lughauth\Features\Access\TenantLoginProvider\Domain\ValueObject\TenantLoginProviderPublicKeyVO;
use Civi\Lughauth\Features\Access\TenantLoginProvider\Domain\ValueObject\Accesor\TenantLoginProviderPublicKeyAccesor;
use Civi\Lughauth\Features\Access\TenantLoginProvider\Domain\ValueObject\TenantLoginProviderPrivateKeyVO;
use Civi\Lughauth\Features\Access\TenantLoginProvider\Domain\ValueObject\Accesor\TenantLoginProviderPrivateKeyAccesor;
use Civi\Lughauth\Features\Access\TenantLoginProvider\Domain\ValueObject\TenantLoginProviderCertificateVO;
use Civi\Lughauth\Features\Access\TenantLoginProvider\Domain\ValueObject\Accesor\TenantLoginProviderCertificateAccesor;
use Civi\Lughauth\Features\Access\TenantLoginProvider\Domain\ValueObject\TenantLoginProviderMetadataVO;
use Civi\Lughauth\Features\Access\TenantLoginProvider\Domain\ValueObject\Accesor\TenantLoginProviderMetadataAccesor;
use Civi\Lughauth\Features\Access\TenantLoginProvider\Domain\ValueObject\TenantLoginProviderUsersEnabledByDefaultVO;
use Civi\Lughauth\Features\Access\TenantLoginProvider\Domain\ValueObject\Accesor\TenantLoginProviderUsersEnabledByDefaultAccesor;
use Civi\Lughauth\Features\Access\TenantLoginProvider\Domain\ValueObject\TenantLoginProviderVersionVO;
use Civi\Lughauth\Features\Access\TenantLoginProvider\Domain\ValueObject\Accesor\TenantLoginProviderVersionAccesor;
use Civi\Lughauth\Features\Access\TenantLoginProvider\Domain\Formula\DisabledCalculator;
use Civi\Lughauth\Features\Access\TenantLoginProvider\Domain\Event\TenantLoginProviderCreateEvent;
use Civi\Lughauth\Features\Access\TenantLoginProvider\Domain\Event\TenantLoginProviderUpdateEvent;
use Civi\Lughauth\Features\Access\TenantLoginProvider\Domain\Event\TenantLoginProviderDeleteEvent;
use Civi\Lughauth\Features\Access\TenantLoginProvider\Domain\Event\TenantLoginProviderEnableEvent;
use Civi\Lughauth\Features\Access\TenantLoginProvider\Domain\Event\TenantLoginProviderDisableEvent;
use Civi\Lughauth\Features\Access\Tenant\Domain\TenantRef;
use Civi\Lughauth\Shared\Connector\FileStorage\FileStorageInterface;
use Civi\Lughauth\Shared\Connector\FileStorage\FileStoreKey;

class TenantLoginProvider extends TenantLoginProviderRef
{
    use TenantLoginProviderTenantAccesor;
    use TenantLoginProviderNameAccesor;
    use TenantLoginProviderSourceAccesor;
    use TenantLoginProviderDisabledAccesor;
    use TenantLoginProviderDirectAccessAccesor;
    use TenantLoginProviderPublicKeyAccesor;
    use TenantLoginProviderPrivateKeyAccesor;
    use TenantLoginProviderCertificateAccesor;
    use TenantLoginProviderMetadataAccesor;
    use TenantLoginProviderUsersEnabledByDefaultAccesor;
    use TenantLoginProviderVersionAccesor;
    private array $recordedEvents = [];

    public function __construct(
        TenantLoginProviderUidVO|string $uid,
        TenantLoginProviderTenantVO|TenantRef $tenant,
        TenantLoginProviderNameVO|string $name,
        TenantLoginProviderSourceVO|TenantLoginProviderSourceOptions $source,
        TenantLoginProviderUsersEnabledByDefaultVO|bool $usersEnabledByDefault,
        TenantLoginProviderDisabledVO|bool|null $disabled = null,
        TenantLoginProviderDirectAccessVO|bool|null $directAccess = null,
        TenantLoginProviderPublicKeyVO|string|null $publicKey = null,
        TenantLoginProviderPrivateKeyVO|string|null $privateKey = null,
        TenantLoginProviderCertificateVO|string|null $certificate = null,
        TenantLoginProviderMetadataVO|string|null $metadata = null,
        TenantLoginProviderVersionVO|int|null $version = null,
    ) {
        parent::__construct($uid);
        $this->_tenant = TenantLoginProviderTenantVO::from($tenant);
        $this->_name = TenantLoginProviderNameVO::from($name);
        $this->_source = TenantLoginProviderSourceVO::from($source);
        $this->_disabled = null === $disabled ? TenantLoginProviderDisabledVO::empty() : TenantLoginProviderDisabledVO::from($disabled);
        $this->_directAccess = null === $directAccess ? TenantLoginProviderDirectAccessVO::empty() : TenantLoginProviderDirectAccessVO::from($directAccess);
        $this->_publicKey = null === $publicKey ? TenantLoginProviderPublicKeyVO::empty() : TenantLoginProviderPublicKeyVO::from($publicKey);
        $this->_privateKey = null === $privateKey ? TenantLoginProviderPrivateKeyVO::empty() : TenantLoginProviderPrivateKeyVO::from($privateKey);
        $this->_certificate = null === $certificate ? TenantLoginProviderCertificateVO::empty() : TenantLoginProviderCertificateVO::from($certificate);
        $this->_metadata = null === $metadata ? TenantLoginProviderMetadataVO::empty() : TenantLoginProviderMetadataVO::from($metadata);
        $this->_usersEnabledByDefault = TenantLoginProviderUsersEnabledByDefaultVO::from($usersEnabledByDefault);
        $this->_version = null === $version ? TenantLoginProviderVersionVO::empty() : TenantLoginProviderVersionVO::from($version);
    }
    public function replace(TenantLoginProviderAttributes $values): TenantLoginProvider
    {
        $value = clone $this;
        $value->_tenant = $values->getTenantOrDefault($this->_tenant);
        $value->_name = $values->getNameOrDefault($this->_name);
        $value->_source = $values->getSourceOrDefault($this->_source);
        $value->_disabled = $values->getDisabledOrDefault($this->_disabled);
        $value->_directAccess = $values->getDirectAccessOrDefault($this->_directAccess);
        $value->_publicKey = $values->getPublicKeyOrDefault($this->_publicKey);
        $value->_privateKey = $values->getPrivateKeyOrDefault($this->_privateKey);
        $value->_certificate = $values->getCertificateOrDefault($this->_certificate);
        $value->_metadata = $values->getMetadataOrDefault($this->_metadata);
        $value->_usersEnabledByDefault = $values->getUsersEnabledByDefaultOrDefault($this->_usersEnabledByDefault);
        $value->_version = $values->getVersionOrDefault($this->_version);
        return $value;
    }
    public static function calculatedFields(): array
    {
        return [ 'disabled'];
    }
    public static function create(TenantLoginProviderAttributes $values): TenantLoginProvider
    {
        $calculated = clone $values;
        $calculated->disabled(DisabledCalculator::calculateDisabled());
        $value = $calculated->build();
        $value->recordedEvents[] = new TenantLoginProviderCreateEvent($value);
        return $value;
    }
    public function update(TenantLoginProviderAttributes $values): TenantLoginProvider
    {
        $calculated = clone $values;
        $calculated->disabled(DisabledCalculator::calculateDisabled($this));
        $value = $this->replace($calculated);
        $value->recordedEvents[] = new TenantLoginProviderUpdateEvent($value, $this);
        return $value;
    }
    public function delete(): TenantLoginProvider
    {
        $value = clone $this;
        $value->recordedEvents[] = new TenantLoginProviderDeleteEvent($value);
        return $value;
    }
    public function commitMetadataWith(FileStorageInterface $store)
    {
        $key = $store->commitContent(new FileStoreKey($this->getMetadata()));
        $this->_metadata = TenantLoginProviderMetadataVO::fromStored($key->key);
    }
    public function enable(): TenantLoginProvider
    {
        $value = clone $this;
        $value->_disabled = TenantLoginProviderDisabledVO::from(false);
        $value->recordedEvents[] = new TenantLoginProviderEnableEvent(payload: $value, original: $this);
        return $value;
    }
    public function disable(): TenantLoginProvider
    {
        $value = clone $this;
        $value->_disabled = TenantLoginProviderDisabledVO::from(true);
        $value->recordedEvents[] = new TenantLoginProviderDisableEvent(payload: $value, original: $this);
        return $value;
    }
    public function asPublicJson(): array
    {
        $data = [];
        $data['uid'] = $this->uid();
        $tenant = $this->getTenant()?->uid();
        if ($tenant) {
            $data['tenant'] = ['$ref' => $tenant];
        }
        $data['name'] = $this->getName();
        $data['source'] = $this->getSource();
        $data['disabled'] = $this->getDisabled();
        $data['directAccess'] = $this->getDirectAccess();
        $data['publicKey'] = $this->getPublicKey();
        $data['privateKey'] = $this->getPrivateKey();
        $data['usersEnabledByDefault'] = $this->getUsersEnabledByDefault();
        $data['version'] = $this->getVersion();
        return $data;
    }
    public function toAttributes(): TenantLoginProviderAttributes
    {
        return (new TenantLoginProviderAttributes())
          ->uid($this->uid())
          ->tenant($this->_tenant)
          ->name($this->_name)
          ->source($this->_source)
          ->disabled($this->_disabled)
          ->directAccess($this->_directAccess)
          ->publicKey($this->_publicKey)
          ->privateKey($this->_privateKey)
          ->certificate($this->_certificate)
          ->metadata($this->_metadata)
          ->usersEnabledByDefault($this->_usersEnabledByDefault)
          ->version($this->_version);
    }
    public function getTheEvents(): array
    {
        return [...$this->recordedEvents];
    }
}
