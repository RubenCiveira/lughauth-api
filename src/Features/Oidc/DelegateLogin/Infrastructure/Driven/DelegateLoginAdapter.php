<?php

/* @autogenerated */
declare(strict_types=1);

namespace Civi\Lughauth\Features\Oidc\DelegateLogin\Infrastructure\Driven;

use Civi\Lughauth\Features\Oidc\Authentication\Domain\AuthenticationRequest;
use Civi\Lughauth\Features\Oidc\Authentication\Domain\AuthenticationResult;
use Civi\Lughauth\Features\Oidc\DelegateLogin\Domain\DelegatedLoginProvider;
use Civi\Lughauth\Features\Oidc\DelegateLogin\Domain\DelegatedUserData;
use Civi\Lughauth\Features\Oidc\DelegateLogin\Domain\Gateway\DelegateLoginRepository;
use Civi\Lughauth\Features\Oidc\DelegateLogin\Infrastructure\Provider\GoogleOAuthProvider;
use Civi\Lughauth\Shared\AppConfig;
use Civi\Lughauth\Shared\Context;
use Civi\Lughauth\Shared\Exception\NotFoundException;
use Override;

class DelegateLoginAdapter implements DelegateLoginRepository
{
    private readonly string $clientId;
    private readonly string $secretId;
    public function __construct(
        private readonly AppConfig $conf,
        private readonly Context $context,
    ) {
        $this->clientId = $conf->get('google.client.id');
        $this->secretId = $conf->get('google.secret');
    }

    #[Override]
    public function save(string $tenant, AuthenticationRequest $client, DelegatedUserData $user): AuthenticationResult
    {
        return new AuthenticationResult(
            valid: true,
            id: $user->email,
            tenant: $tenant,
            tenantName: 'tenantName',
            scope: $client->scope,
            audiences: $client->audiences,
            roles: ['rol-1'],
            groups: ['group-1']
        );
    }
    #[Override]
    public function providers(string $tenant): array
    {
        return [
            new GoogleOAuthProvider($this->conf, $this->context, '22', $this->clientId, $this->secretId)
        ];
    }
    #[Override]
    public function getProvider(string $tenant, string $id): DelegatedLoginProvider
    {
        if ('22' == $id) {
            return new GoogleOAuthProvider($this->conf, $this->context, '22', $this->clientId, $this->secretId);
        } else {
            throw new NotFoundException('');
        }
    }
}
