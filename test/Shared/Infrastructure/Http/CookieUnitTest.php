<?php

/* @autogenerated */
declare(strict_types=1);

use PHPUnit\Framework\TestCase;
use Psr\Http\Message\ResponseInterface;
use Civi\Lughauth\Shared\Infrastructure\Http\Cookie;

final class CookieUnitTest extends TestCase
{
    public function testAttachAddsCookieHeader(): void
    {
        $cookie = new Cookie('session', 'value', new DateInterval('PT1H'), '/', 'example.com', true, true, true);
        $response = $this->createResponse();

        $cookie->attach($response);

        $this->assertStringContainsString('session=value', $this->lastHeader);
        $this->assertStringContainsString('Path=/', $this->lastHeader);
        $this->assertStringContainsString('HttpOnly', $this->lastHeader);
    }

    public function testRemoveAddsExpiredCookie(): void
    {
        $cookie = new Cookie('session', 'value');
        $response = $this->createResponse();

        $cookie->remove($response);

        $this->assertStringContainsString('session=value', $this->lastHeader);
    }

    private ?string $lastHeader = null;

    private function createResponse(): ResponseInterface
    {
        $response = $this->createMock(ResponseInterface::class);
        $response->method('withAddedHeader')
            ->willReturnCallback(function (string $name, string $value) use ($response) {
                $this->lastHeader = $value;
                return $response;
            });
        return $response;
    }
}
