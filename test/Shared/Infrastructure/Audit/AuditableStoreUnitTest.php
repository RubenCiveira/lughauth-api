<?php

/* @autogenerated */
declare(strict_types=1);

use PHPUnit\Framework\TestCase;
use Civi\Lughauth\Shared\Infrastructure\Audit\AuditableStore;
use Civi\Lughauth\Shared\Connector\FileStorage\BinaryContent;
use Civi\Lughauth\Shared\Connector\FileStorage\FileStoreKey;
use Civi\Lughauth\Shared\Connector\FileStorage\FileStorageInterface;

final class AuditableStoreUnitTest extends TestCase
{
    public function testDelegatesToBaseStore(): void
    {
        $base = $this->createMock(FileStorageInterface::class);
        $store = new AuditableStore($base);

        $stream = fopen('php://temp', 'r+');
        $content = new BinaryContent('name', 'mime', new \DateTime(), $stream);
        $key = new FileStoreKey('key');

        $base->expects($this->once())->method('tempStore')->with($content)->willReturn($key);
        $base->expects($this->once())->method('retrieveTempFile')->with($key)->willReturn($content);
        $base->expects($this->once())->method('retrieveFile')->with($key)->willReturn($content);
        $base->expects($this->once())->method('commitContent')->with($key)->willReturn($key);
        $base->expects($this->once())->method('replaceContent')->with($key, $content);
        $base->expects($this->once())->method('deleteFile')->with($key);

        $this->assertSame($key, $store->tempStore($content));
        $this->assertSame($content, $store->retrieveTempFile($key));
        $this->assertSame($content, $store->retrieveFile($key));
        $this->assertSame($key, $store->commitContent($key));
        $store->replaceContent($key, $content);
        $store->deleteFile($key);

        fclose($stream);
    }
}
