<?php

/* @autogenerated */
declare(strict_types=1);

use PHPUnit\Framework\TestCase;
use Civi\Lughauth\Shared\Infrastructure\Audit\AuditContext;
use Civi\Lughauth\Shared\Infrastructure\Audit\AuditChange;

final class AuditContextUnitTest extends TestCase
{
    public function testActionAndChangesLifecycle(): void
    {
        $context = new AuditContext();
        $this->assertFalse($context->hasAction());
        $this->assertNull($context->getActionId());

        $context->setActionId('action-1');
        $this->assertTrue($context->hasAction());
        $this->assertSame('action-1', $context->getActionId());

        $change = new AuditChange('action-1', 'User', '1', 'update', ['name' => 'A']);
        $context->addChange($change);
        $changes = $context->consumeChanges();

        $this->assertCount(1, $changes);
        $this->assertSame($change, $changes[0]);
        $this->assertSame([], $context->consumeChanges());

        $context->reset();
        $this->assertFalse($context->hasAction());
        $this->assertNull($context->getActionId());
    }
}
