<?php

/* @autogenerated */
declare(strict_types=1);

use PHPUnit\Framework\TestCase;
use Slim\Interfaces\DispatcherInterface;
use Slim\Interfaces\RouteParserInterface;
use Slim\Routing\RouteContext;
use Slim\Routing\RoutingResults;
use Civi\Lughauth\Shared\Infrastructure\View\TwigBuilder;
use Civi\Lughauth\Shared\Infrastructure\View\AssetOptimizingTwigEnvironment;

/**
 * Unit tests for {@see TwigBuilder}.
 */
final class TwigBuilderUnitTest extends TestCase
{
    /**
     * Ensures the builder returns the optimized Twig environment.
     */
    public function testBuildReturnsTwigEnvironment(): void
    {
        /* Arrange: create the builder and request context. */
        $builder = new TwigBuilder();
        $request = $this->createRequest('/base');

        /* Act: build the Twig environment. */
        $env = $builder->build($request);

        /* Assert: verify the environment type. */
        $this->assertInstanceOf(AssetOptimizingTwigEnvironment::class, $env);
    }

    private function createRequest(string $basePath): \Psr\Http\Message\ServerRequestInterface
    {
        $dispatcher = $this->createMock(DispatcherInterface::class);
        $routeParser = $this->createMock(RouteParserInterface::class);
        $routingResults = new RoutingResults($dispatcher, 'GET', '/', RoutingResults::NOT_FOUND);

        $request = $this->createMock(\Psr\Http\Message\ServerRequestInterface::class);
        $request->method('getAttribute')->willReturnMap([
            [RouteContext::ROUTE, null, null],
            [RouteContext::ROUTE_PARSER, null, $routeParser],
            [RouteContext::ROUTING_RESULTS, null, $routingResults],
            [RouteContext::BASE_PATH, null, $basePath],
        ]);

        return $request;
    }
}
