<?php

/* @autogenerated */
declare(strict_types=1);

use PHPUnit\Framework\TestCase;
use Symfony\Component\RateLimiter\Storage\InMemoryStorage;
use Civi\Lughauth\Shared\AppConfig;
use Civi\Lughauth\Shared\Infrastructure\Middelware\Rate\RateConfig;

/**
 * Unit tests for RateConfig.
 */
final class RateConfigUnitTest extends TestCase
{
    /**
     * Ensures default configuration values are applied.
     */
    public function testConfigDefaults(): void
    {
        /*
         * Arrange: create config that returns defaults.
         */
        $storage = new InMemoryStorage();
        $config = new class () extends AppConfig {
            public function __construct()
            {
                $this->develop = true;
                $this->name = 'app';
                $this->managementEndpoint = '/management';
            }

            public function get(string $name, mixed $def = null): mixed
            {
                return $def;
            }
        };

        /*
         * Act: create the rate configuration.
         */
        $rateConfig = new RateConfig($storage, $config);

        /*
         * Assert: verify default values are set.
         */
        $this->assertSame('app_global_limit', $rateConfig->id);
        $this->assertSame('sliding_window', $rateConfig->policy);
        $this->assertSame(150, $rateConfig->limit);
        $this->assertSame('1 minute', $rateConfig->interval);
        $this->assertSame($storage, $rateConfig->storage());
    }
}
