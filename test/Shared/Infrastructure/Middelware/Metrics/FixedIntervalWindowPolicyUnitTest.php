<?php

/* @autogenerated */
declare(strict_types=1);

use PHPUnit\Framework\TestCase;
use Civi\Lughauth\Shared\Infrastructure\Middelware\Metrics\FixedIntervalWindowPolicy;

final class FixedIntervalWindowPolicyUnitTest extends TestCase
{
    public function testMustTraceWritesLockFile(): void
    {
        $path = sys_get_temp_dir() . '/trace_lock_' . uniqid();
        $policy = new FixedIntervalWindowPolicy($path, 1);

        $this->assertTrue($policy->mustTrace());
        $this->assertFalse($policy->mustTrace());
    }

    public function testMustTraceHandlesInvalidTimestamp(): void
    {
        $path = sys_get_temp_dir() . '/trace_lock_' . uniqid();
        file_put_contents($path, (string) (time() + 10000));

        $policy = new FixedIntervalWindowPolicy($path, 1);
        $this->assertTrue($policy->mustTrace());
    }
}
