<?php

/* @autogenerated */
declare(strict_types=1);

use PHPUnit\Framework\TestCase;
use Civi\Lughauth\Shared\Infrastructure\Management\Collector\StatusDataEnvelope;

/**
 * Unit tests for {@see StatusDataEnvelope}.
 */
final class StatusDataEnvelopeUnitTest extends TestCase
{
    /**
     * Ensures factories and raw parsing return expected codes.
     */
    public function testFactoriesAndFromRaw(): void
    {
        /* Arrange: build status data with factories and raw payloads. */
        $ok = StatusDataEnvelope::ok();
        $error = StatusDataEnvelope::error();
        $unset = StatusDataEnvelope::unset();

        /* Act: read status codes and parse raw payloads. */
        $okCode = $ok->getCode();
        $errorCode = $error->getCode();
        $unsetCode = $unset->getCode();
        $fromRawError = StatusDataEnvelope::fromRaw(['code' => 1, 'message' => 'fail']);
        $fromRawOk = StatusDataEnvelope::fromRaw(['code' => 0]);
        $fromRawUnset = StatusDataEnvelope::fromRaw([]);

        /* Assert: verify status codes and descriptions match expectations. */
        $this->assertSame(StatusDataEnvelope::CODE_OK, $okCode);
        $this->assertSame(StatusDataEnvelope::CODE_ERROR, $errorCode);
        $this->assertSame(StatusDataEnvelope::CODE_UNSET, $unsetCode);

        $this->assertSame(StatusDataEnvelope::CODE_ERROR, $fromRawError->getCode());
        $this->assertSame('fail', $fromRawError->getDescription());

        $this->assertSame(StatusDataEnvelope::CODE_OK, $fromRawOk->getCode());

        $this->assertSame(StatusDataEnvelope::CODE_UNSET, $fromRawUnset->getCode());
    }

    /**
     * Ensures null or unknown codes default to unset.
     */
    public function testFromRawDefaults(): void
    {
        /* Arrange: payloads without codes or with unknown codes. */
        $fromNull = StatusDataEnvelope::fromRaw(null);
        $fromUnknown = StatusDataEnvelope::fromRaw(['code' => 99]);

        /* Act: fetch codes and descriptions. */
        $nullCode = $fromNull->getCode();
        $unknownCode = $fromUnknown->getCode();
        $unknownDescription = $fromUnknown->getDescription();

        /* Assert: verify defaults are applied. */
        $this->assertSame(StatusDataEnvelope::CODE_UNSET, $nullCode);
        $this->assertSame(StatusDataEnvelope::CODE_UNSET, $unknownCode);
        $this->assertSame('', $unknownDescription);
    }
}
