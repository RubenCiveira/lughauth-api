<?php

/* @autogenerated */
declare(strict_types=1);

namespace Civi\Lughauth\Shared\Observability {
    if (!function_exists(__NAMESPACE__ . '\\error_log')) {
        function error_log(string $message): void
        {
        }
    }
}

namespace {
    use PHPUnit\Framework\TestCase;
    use Psr\Container\ContainerInterface;
    use Psr\Log\LoggerInterface;
    use Civi\Lughauth\Shared\Observability\LoggerAwareTrait;

    final class LoggerAwareTraitUnitTest extends TestCase
    {
        public function testSetLoggerFromContainerMissing(): void
        {
            $service = new class () {
                use LoggerAwareTrait;
            };
            $container = $this->createMock(ContainerInterface::class);
            $container->expects($this->once())
                ->method('has')
                ->with(LoggerInterface::class)
                ->willReturn(false);
            $container->expects($this->never())->method('get');

            $service->setLoggerFromContainer($container);

            $service->logInfo('fallback');
            $service->logDebug('fallback');
            $service->logError('fallback');

            $this->assertTrue(true);
        }

        public function testLoggerMethodsCallLogger(): void
        {
            $service = new class () {
                use LoggerAwareTrait;
            };

            $logger = $this->createMock(LoggerInterface::class);
            $logger->expects($this->once())->method('emergency')->with('e', ['a' => 1]);
            $logger->expects($this->once())->method('alert')->with('a', ['b' => 2]);
            $logger->expects($this->once())->method('critical')->with('c', ['c' => 3]);
            $logger->expects($this->once())->method('error')->with('e2', ['d' => 4]);
            $logger->expects($this->once())->method('warning')->with('w', ['e' => 5]);
            $logger->expects($this->once())->method('notice')->with('n', ['f' => 6]);
            $logger->expects($this->once())->method('info')->with('i', ['g' => 7]);
            $logger->expects($this->once())->method('debug')->with('d', ['h' => 8]);

            $service->setLogger($logger);

            $service->logEmergency('e', ['a' => 1]);
            $service->logAlert('a', ['b' => 2]);
            $service->logCritical('c', ['c' => 3]);
            $service->logError('e2', ['d' => 4]);
            $service->logWarning('w', ['e' => 5]);
            $service->logNotice('n', ['f' => 6]);
            $service->logInfo('i', ['g' => 7]);
            $service->logDebug('d', ['h' => 8]);
        }

        public function testSetLoggerFromContainerUsesLogger(): void
        {
            $service = new class () {
                use LoggerAwareTrait;
            };

            $logger = $this->createMock(LoggerInterface::class);
            $logger->expects($this->once())->method('info')->with('ready', []);

            $container = $this->createMock(ContainerInterface::class);
            $container->expects($this->once())
                ->method('has')
                ->with(LoggerInterface::class)
                ->willReturn(true);
            $container->expects($this->once())
                ->method('get')
                ->with(LoggerInterface::class)
                ->willReturn($logger);

            $service->setLoggerFromContainer($container);
            $service->logInfo('ready');
        }
    }
}
