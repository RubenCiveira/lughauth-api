<?php

/* @autogenerated */
declare(strict_types=1);

use PHPUnit\Framework\TestCase;
use Civi\Lughauth\Shared\Connector\FileStorage\BinaryContent;
use Civi\Lughauth\Shared\Connector\FileStorage\FileStoreKey;
use Civi\Lughauth\Shared\Connector\FileStorage\FileStorageInterface;

/**
 * Unit tests for FileStorageInterface.
 */
final class FileStorageInterfaceUnitTest extends TestCase
{
    /**
     * Ensures the interface contract can be implemented.
     */
    public function testInterfaceContractCanBeImplemented(): void
    {
        /*
         * Arrange: create a test storage implementation.
         */
        $storage = new class () implements FileStorageInterface {
            public function tempStore(BinaryContent $source): FileStoreKey
            {
                return new FileStoreKey('tmp');
            }

            public function retrieveTempFile(FileStoreKey $key): ?BinaryContent
            {
                return null;
            }

            public function retrieveFile(FileStoreKey $key): ?BinaryContent
            {
                return null;
            }

            public function commitContent(FileStoreKey $key): FileStoreKey
            {
                return $key;
            }

            public function replaceContent(FileStoreKey $key, BinaryContent $content): void
            {
            }

            public function deleteFile(FileStoreKey $key): void
            {
            }
        };

        /*
         * Act: store temporary content and commit it.
         */
        $stream = fopen('php://temp', 'r+');
        $key = $storage->tempStore(new BinaryContent('name', 'mime', new DateTime(), $stream));
        $committed = $storage->commitContent($key);

        /*
         * Assert: verify the key types and values are returned.
         */
        $this->assertInstanceOf(FileStoreKey::class, $key);
        $this->assertSame('tmp', $key->key);
        $this->assertSame($key, $committed);

        fclose($stream);
    }
}
