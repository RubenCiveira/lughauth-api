<?php

# @autogenerated
declare(strict_types=1);

use Civi\Lughauth\Features\Access\TrustedClient\Domain\ValueObject\TrustedClientAllowedRedirectsListRef;
use Civi\Lughauth\Features\Access\TrustedClient\Domain\ValueObject\TrustedClientAllowedRedirectsUidVO;
use Civi\Lughauth\Features\Access\TrustedClient\Domain\ValueObject\TrustedClientAllowedRedirectsUrlVO;
use Civi\Lughauth\Features\Access\TrustedClient\Domain\ValueObject\TrustedClientAllowedRedirectsVersionVO;
use Civi\Lughauth\Features\Access\TrustedClient\Domain\ValueObject\TrustedClientAllowedRedirectsItem;
use PHPUnit\Framework\TestCase;
use Civi\Lughauth\Features\Access\TrustedClient\Domain\TrustedClient;

final class TrustedClientUnitTest extends TestCase
{
    public function test_init_store_values(): void
    {
        // @Arrange
        $one = new TrustedClient(
            uid: 'one',
            code: 'one',
            publicAllow: true,
            secretOauth: 'cyphered://cypher',
            enabled: true,
            allowedRedirects: new TrustedClientAllowedRedirectsListRef(new TrustedClientAllowedRedirectsItem(
                TrustedClientAllowedRedirectsUidVO::from('one'),
                TrustedClientAllowedRedirectsUrlVO::from('one'),
                TrustedClientAllowedRedirectsVersionVO::from(1)
            )),
            version: 1,
        );

        // @Act
        $other = $one->toAttributes()->build();

        // @Assert
        $this->assertEquals($one->uid(), $other->uid());
        $this->assertEquals($one->getCode(), $other->getCode());
        $this->assertTrue($one->isCodeChanged());
        $this->assertEquals($one->getPublicAllow(), $other->getPublicAllow());
        $this->assertTrue($one->isPublicAllowChanged());
        $this->assertEquals($one->getSecretOauth(), $other->getSecretOauth());
        $this->assertTrue($one->isSecretOauthChanged());
        $this->assertEquals($one->getAllowedRedirects(), $other->getAllowedRedirects());
        $this->assertTrue($one->isAllowedRedirectsChanged());
        $this->assertEquals($one->getVersion(), $other->getVersion());
        $this->assertTrue($one->isVersionChanged());
    }
    public function test_replace_change_values(): void
    {
        // @Arrange
        $base = new TrustedClient(
            uid: 'one',
            code: 'one',
            publicAllow: true,
            secretOauth: 'cyphered://cypher',
            enabled: true,
            allowedRedirects: new TrustedClientAllowedRedirectsListRef(new TrustedClientAllowedRedirectsItem(
                TrustedClientAllowedRedirectsUidVO::from('one'),
                TrustedClientAllowedRedirectsUrlVO::from('one'),
                TrustedClientAllowedRedirectsVersionVO::from(1)
            )),
            version: 1,
        );
        $other = new TrustedClient(
            uid: 'other',
            code: 'other',
            publicAllow: false,
            secretOauth: 'cyphered://ocyphered',
            enabled: false,
            allowedRedirects: new TrustedClientAllowedRedirectsListRef(new TrustedClientAllowedRedirectsItem(
                TrustedClientAllowedRedirectsUidVO::from('other'),
                TrustedClientAllowedRedirectsUrlVO::from('other'),
                TrustedClientAllowedRedirectsVersionVO::from(2)
            )),
            version: 2,
        );

        // @Act
        $one = $base->replace($other->toAttributes());

        // @Assert
        $this->assertEquals($one->uid(), $base->uid());
        $this->assertEquals($one->getCode(), $other->getCode());
        $this->assertTrue($one->isCodeChanged($base));
        $this->assertEquals($one->getPublicAllow(), $other->getPublicAllow());
        $this->assertTrue($one->isPublicAllowChanged($base));
        $this->assertEquals($one->getSecretOauth(), $other->getSecretOauth());
        $this->assertTrue($one->isSecretOauthChanged($base));
        $this->assertEquals($one->getAllowedRedirects(), $other->getAllowedRedirects());
        $this->assertTrue($one->isAllowedRedirectsChanged($base));
        $this->assertEquals($one->getVersion(), $other->getVersion());
        $this->assertTrue($one->isVersionChanged($base));
    }
    public function test_create_store_values(): void
    {
        // @Arrange
        $one = new TrustedClient(
            uid: 'one',
            code: 'one',
            publicAllow: true,
            secretOauth: 'cyphered://cypher',
            enabled: true,
            allowedRedirects: new TrustedClientAllowedRedirectsListRef(new TrustedClientAllowedRedirectsItem(
                TrustedClientAllowedRedirectsUidVO::from('one'),
                TrustedClientAllowedRedirectsUrlVO::from('one'),
                TrustedClientAllowedRedirectsVersionVO::from(1)
            )),
            version: 1,
        );

        // @Act
        $other = TrustedClient::create($one->toAttributes());

        // @Assert
        $this->assertEquals($one->uid(), $other->uid());
        $this->assertEquals($one->getCode(), $other->getCode());
        $this->assertTrue($one->isCodeChanged());
        $this->assertEquals($one->getPublicAllow(), $other->getPublicAllow());
        $this->assertTrue($one->isPublicAllowChanged());
        $this->assertEquals($one->getSecretOauth(), $other->getSecretOauth());
        $this->assertTrue($one->isSecretOauthChanged());
        $this->assertEquals($one->getAllowedRedirects(), $other->getAllowedRedirects());
        $this->assertTrue($one->isAllowedRedirectsChanged());
        $this->assertEquals($one->getVersion(), $other->getVersion());
        $this->assertTrue($one->isVersionChanged());
        $this->assertCount(0, $one->getTheEvents());
        $this->assertCount(1, $other->getTheEvents());
    }
    public function test_update_change_values(): void
    {
        $base = new TrustedClient(
            uid: 'one',
            code: 'one',
            publicAllow: true,
            secretOauth: 'cyphered://cypher',
            enabled: true,
            allowedRedirects: new TrustedClientAllowedRedirectsListRef(new TrustedClientAllowedRedirectsItem(
                TrustedClientAllowedRedirectsUidVO::from('one'),
                TrustedClientAllowedRedirectsUrlVO::from('one'),
                TrustedClientAllowedRedirectsVersionVO::from(1)
            )),
            version: 1,
        );
        $other = new TrustedClient(
            uid: 'other',
            code: 'other',
            publicAllow: false,
            secretOauth: 'cyphered://ocyphered',
            enabled: false,
            allowedRedirects: new TrustedClientAllowedRedirectsListRef(new TrustedClientAllowedRedirectsItem(
                TrustedClientAllowedRedirectsUidVO::from('other'),
                TrustedClientAllowedRedirectsUrlVO::from('other'),
                TrustedClientAllowedRedirectsVersionVO::from(2)
            )),
            version: 2,
        );

        // @Act
        $one = $base->update($other->toAttributes());

        // @Assert
        $this->assertEquals($one->uid(), $base->uid());
        $this->assertEquals($one->getCode(), $other->getCode());
        $this->assertTrue($one->isCodeChanged($base));
        $this->assertEquals($one->getPublicAllow(), $other->getPublicAllow());
        $this->assertTrue($one->isPublicAllowChanged($base));
        $this->assertEquals($one->getSecretOauth(), $other->getSecretOauth());
        $this->assertTrue($one->isSecretOauthChanged($base));
        $this->assertEquals($one->getAllowedRedirects(), $other->getAllowedRedirects());
        $this->assertTrue($one->isAllowedRedirectsChanged($base));
        $this->assertEquals($one->getVersion(), $other->getVersion());
        $this->assertTrue($one->isVersionChanged($base));
        $this->assertCount(0, $other->getTheEvents());
        $this->assertCount(1, $one->getTheEvents());
    }
    public function test_delete_store_values(): void
    {
        // @Arrange
        $one = new TrustedClient(
            uid: 'one',
            code: 'one',
            publicAllow: true,
            secretOauth: 'cyphered://cypher',
            enabled: true,
            allowedRedirects: new TrustedClientAllowedRedirectsListRef(new TrustedClientAllowedRedirectsItem(
                TrustedClientAllowedRedirectsUidVO::from('one'),
                TrustedClientAllowedRedirectsUrlVO::from('one'),
                TrustedClientAllowedRedirectsVersionVO::from(1)
            )),
            version: 1,
        );

        // @Act
        $other = $one->delete();

        // @Assert
        $this->assertEquals($one->uid(), $other->uid());
        $this->assertEquals($one->getCode(), $other->getCode());
        $this->assertTrue($one->isCodeChanged());
        $this->assertEquals($one->getPublicAllow(), $other->getPublicAllow());
        $this->assertTrue($one->isPublicAllowChanged());
        $this->assertEquals($one->getSecretOauth(), $other->getSecretOauth());
        $this->assertTrue($one->isSecretOauthChanged());
        $this->assertEquals($one->getAllowedRedirects(), $other->getAllowedRedirects());
        $this->assertTrue($one->isAllowedRedirectsChanged());
        $this->assertEquals($one->getVersion(), $other->getVersion());
        $this->assertTrue($one->isVersionChanged());
    }
    public function test_enable_modify(): void
    {
        // @Arrange
        $source = new TrustedClient(
            uid: 'one',
            code: 'one',
            publicAllow: true,
            secretOauth: 'cyphered://cypher',
            enabled: true,
            allowedRedirects: new TrustedClientAllowedRedirectsListRef(new TrustedClientAllowedRedirectsItem(
                TrustedClientAllowedRedirectsUidVO::from('one'),
                TrustedClientAllowedRedirectsUrlVO::from('one'),
                TrustedClientAllowedRedirectsVersionVO::from(1)
            )),
            version: 1,
        );
        $sourceEnabled = false;
        $targetEnabled = true;
        $source = $source->withEnabled($sourceEnabled);

        // @Act
        $target = $source->enable();

        // @Assert
        $this->assertEquals(false, $source->getEnabled());
        $this->assertEquals($targetEnabled, $target->getEnabled());
        $this->assertNotEquals($sourceEnabled, $target->getEnabled());
    }
    public function test_disable_modify(): void
    {
        // @Arrange
        $source = new TrustedClient(
            uid: 'one',
            code: 'one',
            publicAllow: true,
            secretOauth: 'cyphered://cypher',
            enabled: true,
            allowedRedirects: new TrustedClientAllowedRedirectsListRef(new TrustedClientAllowedRedirectsItem(
                TrustedClientAllowedRedirectsUidVO::from('one'),
                TrustedClientAllowedRedirectsUrlVO::from('one'),
                TrustedClientAllowedRedirectsVersionVO::from(1)
            )),
            version: 1,
        );
        $sourceEnabled = true;
        $targetEnabled = false;
        $source = $source->withEnabled($sourceEnabled);

        // @Act
        $target = $source->disable();

        // @Assert
        $this->assertEquals(true, $source->getEnabled());
        $this->assertEquals($targetEnabled, $target->getEnabled());
        $this->assertNotEquals($sourceEnabled, $target->getEnabled());
    }
}
