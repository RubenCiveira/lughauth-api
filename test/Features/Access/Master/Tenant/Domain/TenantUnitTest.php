<?php

# @autogenerated
declare(strict_types=1);

use PHPUnit\Framework\TestCase;
use Civi\Lughauth\Features\Access\Master\Tenant\Domain\Tenant;

final class TenantUnitTest extends TestCase
{
    public function test_init_store_values(): void
    {
        // @Arrange
        $one = new Tenant(
            uid: 'one',
            name: 'one',
            root: true,
            domain: 'one',
            enabled: true,
            markForDelete: true,
            markForDeleteTime: (new \DateTimeImmutable('1980-08-20T14:32:45.123Z')),
            version: 1,
        );

        // @Act
        $other = $one->toAttributes()->build();
        $calculated = Tenant::calculatedFields();

        // @Assert
        $this->assertEquals([ 'enabled', 'markForDelete', 'markForDeleteTime'], $calculated);
        $this->assertEquals($one->uid(), $other->uid());
        $this->assertEquals($one->getName(), $other->getName());
        $this->assertTrue($one->isNameChanged());
        $this->assertEquals($one->isRoot(), $other->isRoot());
        $this->assertTrue($one->isRootChanged());
        $this->assertEquals($one->getDomain(), $other->getDomain());
        $this->assertTrue($one->isDomainChanged());
        $this->assertEquals($one->getVersion(), $other->getVersion());
        $this->assertTrue($one->isVersionChanged());
    }
    public function test_replace_change_values(): void
    {
        // @Arrange
        $base = new Tenant(
            uid: 'one',
            name: 'one',
            root: true,
            domain: 'one',
            enabled: true,
            markForDelete: true,
            markForDeleteTime: (new \DateTimeImmutable('1980-08-20T14:32:45.123Z')),
            version: 1,
        );
        $other = new Tenant(
            uid: 'other',
            name: 'other',
            root: false,
            domain: 'other',
            enabled: false,
            markForDelete: false,
            markForDeleteTime: (new \DateTimeImmutable('1981-09-06T14:32:45.123Z')),
            version: 2,
        );

        // @Act
        $one = $base->replace($other->toAttributes());

        // @Assert
        $this->assertEquals($one->uid(), $base->uid());
        $this->assertEquals($one->getName(), $other->getName());
        $this->assertTrue($one->isNameChanged($base));
        $this->assertEquals($one->isRoot(), $other->isRoot());
        $this->assertTrue($one->isRootChanged($base));
        $this->assertEquals($one->getDomain(), $other->getDomain());
        $this->assertTrue($one->isDomainChanged($base));
        $this->assertEquals($one->getVersion(), $other->getVersion());
        $this->assertTrue($one->isVersionChanged($base));
    }
    public function test_json_compare(): void
    {
        // @Arrange
        $one = new Tenant(
            uid: 'one',
            name: 'one',
            root: true,
            domain: 'one',
            enabled: true,
            markForDelete: true,
            markForDeleteTime: (new \DateTimeImmutable('1980-08-20T14:32:45.123Z')),
            version: 1,
        );

        // @Act
        $json = $one->asPublicJson();

        // @Assert
        $this->assertEquals('one', $json['uid']);
        $this->assertEquals('one', $json['name']);
        $this->assertEquals(true, $json['root']);
        $this->assertEquals('one', $json['domain']);
        $this->assertEquals(true, $json['enabled']);
        $this->assertEquals(true, $json['markForDelete']);
        $this->assertEquals((new \DateTimeImmutable('1980-08-20T14:32:45.123Z')), $json['markForDeleteTime']);
        $this->assertEquals(1, $json['version']);
    }
    public function test_create_store_values(): void
    {
        // @Arrange
        $one = new Tenant(
            uid: 'one',
            name: 'one',
            root: true,
            domain: 'one',
            enabled: true,
            markForDelete: true,
            markForDeleteTime: (new \DateTimeImmutable('1980-08-20T14:32:45.123Z')),
            version: 1,
        );

        // @Act
        $other = Tenant::create($one->toAttributes());

        // @Assert
        $this->assertEquals($one->uid(), $other->uid());
        $this->assertEquals($one->getName(), $other->getName());
        $this->assertTrue($one->isNameChanged());
        $this->assertEquals($one->isRoot(), $other->isRoot());
        $this->assertTrue($one->isRootChanged());
        $this->assertEquals($one->getDomain(), $other->getDomain());
        $this->assertTrue($one->isDomainChanged());
        $this->assertEquals($one->getVersion(), $other->getVersion());
        $this->assertTrue($one->isVersionChanged());
        $this->assertCount(0, $one->getTheEvents());
        $this->assertCount(1, $other->getTheEvents());
    }
    public function test_update_change_values(): void
    {
        $base = new Tenant(
            uid: 'one',
            name: 'one',
            root: true,
            domain: 'one',
            enabled: true,
            markForDelete: true,
            markForDeleteTime: (new \DateTimeImmutable('1980-08-20T14:32:45.123Z')),
            version: 1,
        );
        $other = new Tenant(
            uid: 'other',
            name: 'other',
            root: false,
            domain: 'other',
            enabled: false,
            markForDelete: false,
            markForDeleteTime: (new \DateTimeImmutable('1981-09-06T14:32:45.123Z')),
            version: 2,
        );

        // @Act
        $one = $base->update($other->toAttributes());

        // @Assert
        $this->assertEquals($one->uid(), $base->uid());
        $this->assertEquals($one->getName(), $other->getName());
        $this->assertTrue($one->isNameChanged($base));
        $this->assertEquals($one->isRoot(), $other->isRoot());
        $this->assertTrue($one->isRootChanged($base));
        $this->assertEquals($one->getDomain(), $other->getDomain());
        $this->assertTrue($one->isDomainChanged($base));
        $this->assertEquals($one->getVersion(), $other->getVersion());
        $this->assertTrue($one->isVersionChanged($base));
        $this->assertCount(0, $other->getTheEvents());
        $this->assertCount(1, $one->getTheEvents());
    }
    public function test_delete_store_values(): void
    {
        // @Arrange
        $one = new Tenant(
            uid: 'one',
            name: 'one',
            root: true,
            domain: 'one',
            enabled: true,
            markForDelete: true,
            markForDeleteTime: (new \DateTimeImmutable('1980-08-20T14:32:45.123Z')),
            version: 1,
        );

        // @Act
        $other = $one->delete();

        // @Assert
        $this->assertEquals($one->uid(), $other->uid());
        $this->assertEquals($one->getName(), $other->getName());
        $this->assertTrue($one->isNameChanged());
        $this->assertEquals($one->isRoot(), $other->isRoot());
        $this->assertTrue($one->isRootChanged());
        $this->assertEquals($one->getDomain(), $other->getDomain());
        $this->assertTrue($one->isDomainChanged());
        $this->assertEquals($one->getVersion(), $other->getVersion());
        $this->assertTrue($one->isVersionChanged());
    }
    public function test_enable_modify(): void
    {
        // @Arrange
        $source = new Tenant(
            uid: 'one',
            name: 'one',
            root: true,
            domain: 'one',
            enabled: true,
            markForDelete: true,
            markForDeleteTime: (new \DateTimeImmutable('1980-08-20T14:32:45.123Z')),
            version: 1,
        );
        $sourceEnabled = false;
        $targetEnabled = true;
        $source = $source->withEnabled($sourceEnabled);

        // @Act
        $target = $source->enable();

        // @Assert
        $this->assertEquals(false, $source->isEnabled());
        $this->assertEquals($targetEnabled, $target->isEnabled());
        $this->assertNotEquals($sourceEnabled, $target->isEnabled());
    }
    public function test_disable_modify(): void
    {
        // @Arrange
        $source = new Tenant(
            uid: 'one',
            name: 'one',
            root: true,
            domain: 'one',
            enabled: true,
            markForDelete: true,
            markForDeleteTime: (new \DateTimeImmutable('1980-08-20T14:32:45.123Z')),
            version: 1,
        );
        $sourceEnabled = true;
        $targetEnabled = false;
        $source = $source->withEnabled($sourceEnabled);

        // @Act
        $target = $source->disable();

        // @Assert
        $this->assertEquals(true, $source->isEnabled());
        $this->assertEquals($targetEnabled, $target->isEnabled());
        $this->assertNotEquals($sourceEnabled, $target->isEnabled());
    }
}
