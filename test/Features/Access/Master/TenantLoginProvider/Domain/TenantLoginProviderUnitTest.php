<?php

# @autogenerated
declare(strict_types=1);

use Civi\Lughauth\Features\Access\Master\Tenant\Domain\TenantRef;
use Civi\Lughauth\Features\Access\Master\TenantLoginProvider\Domain\TenantLoginProviderSourceOptions;
use PHPUnit\Framework\TestCase;
use Civi\Lughauth\Features\Access\Master\TenantLoginProvider\Domain\TenantLoginProvider;

final class TenantLoginProviderUnitTest extends TestCase
{
    public function test_init_store_values(): void
    {
        // @Arrange
        $one = new TenantLoginProvider(
            uid: 'one',
            tenant: new TenantRef('one'),
            name: 'one',
            source: TenantLoginProviderSourceOptions::GOOGLE,
            disabled: true,
            directAccess: true,
            publicKey: 'one',
            privateKey: 'one',
            certificate: 'one',
            metadata: 'store://bin',
            usersEnabledByDefault: true,
            version: 1,
        );

        // @Act
        $other = $one->toAttributes()->build();
        $calculated = TenantLoginProvider::calculatedFields();

        // @Assert
        $this->assertEquals([ 'disabled'], $calculated);
        $this->assertEquals($one->uid(), $other->uid());
        $this->assertEquals($one->getTenant(), $other->getTenant());
        $this->assertTrue($one->isTenantChanged());
        $this->assertEquals($one->getName(), $other->getName());
        $this->assertTrue($one->isNameChanged());
        $this->assertEquals($one->getSource(), $other->getSource());
        $this->assertTrue($one->isSourceChanged());
        $this->assertEquals($one->isDirectAccess(), $other->isDirectAccess());
        $this->assertTrue($one->isDirectAccessChanged());
        $this->assertEquals($one->getPublicKey(), $other->getPublicKey());
        $this->assertTrue($one->isPublicKeyChanged());
        $this->assertEquals($one->getPrivateKey(), $other->getPrivateKey());
        $this->assertTrue($one->isPrivateKeyChanged());
        $this->assertEquals($one->getCertificate(), $other->getCertificate());
        $this->assertTrue($one->isCertificateChanged());
        $this->assertEquals($one->getMetadata(), $other->getMetadata());
        $this->assertTrue($one->isMetadataChanged());
        $this->assertEquals($one->isUsersEnabledByDefault(), $other->isUsersEnabledByDefault());
        $this->assertTrue($one->isUsersEnabledByDefaultChanged());
        $this->assertEquals($one->getVersion(), $other->getVersion());
        $this->assertTrue($one->isVersionChanged());
    }
    public function test_replace_change_values(): void
    {
        // @Arrange
        $base = new TenantLoginProvider(
            uid: 'one',
            tenant: new TenantRef('one'),
            name: 'one',
            source: TenantLoginProviderSourceOptions::GOOGLE,
            disabled: true,
            directAccess: true,
            publicKey: 'one',
            privateKey: 'one',
            certificate: 'one',
            metadata: 'store://bin',
            usersEnabledByDefault: true,
            version: 1,
        );
        $other = new TenantLoginProvider(
            uid: 'other',
            tenant: new TenantRef('other'),
            name: 'other',
            source: TenantLoginProviderSourceOptions::GITHUB,
            disabled: false,
            directAccess: false,
            publicKey: 'other',
            privateKey: 'other',
            certificate: 'other',
            metadata: 'store://obin',
            usersEnabledByDefault: false,
            version: 2,
        );

        // @Act
        $one = $base->replace($other->toAttributes());

        // @Assert
        $this->assertEquals($one->uid(), $base->uid());
        $this->assertEquals($one->getTenant(), $other->getTenant());
        $this->assertTrue($one->isTenantChanged($base));
        $this->assertEquals($one->getName(), $other->getName());
        $this->assertTrue($one->isNameChanged($base));
        $this->assertEquals($one->getSource(), $other->getSource());
        $this->assertTrue($one->isSourceChanged($base));
        $this->assertEquals($one->isDirectAccess(), $other->isDirectAccess());
        $this->assertTrue($one->isDirectAccessChanged($base));
        $this->assertEquals($one->getPublicKey(), $other->getPublicKey());
        $this->assertTrue($one->isPublicKeyChanged($base));
        $this->assertEquals($one->getPrivateKey(), $other->getPrivateKey());
        $this->assertTrue($one->isPrivateKeyChanged($base));
        $this->assertEquals($one->getCertificate(), $other->getCertificate());
        $this->assertTrue($one->isCertificateChanged($base));
        $this->assertEquals($one->getMetadata(), $other->getMetadata());
        $this->assertTrue($one->isMetadataChanged($base));
        $this->assertEquals($one->isUsersEnabledByDefault(), $other->isUsersEnabledByDefault());
        $this->assertTrue($one->isUsersEnabledByDefaultChanged($base));
        $this->assertEquals($one->getVersion(), $other->getVersion());
        $this->assertTrue($one->isVersionChanged($base));
    }
    public function test_json_compare(): void
    {
        // @Arrange
        $one = new TenantLoginProvider(
            uid: 'one',
            tenant: new TenantRef('one'),
            name: 'one',
            source: TenantLoginProviderSourceOptions::GOOGLE,
            disabled: true,
            directAccess: true,
            publicKey: 'one',
            privateKey: 'one',
            certificate: 'one',
            metadata: 'store://bin',
            usersEnabledByDefault: true,
            version: 1,
        );

        // @Act
        $json = $one->asPublicJson();

        // @Assert
        $this->assertEquals('one', $json['uid']);
        $this->assertEquals('one', $json['tenant']['$ref']);
        $this->assertEquals('one', $json['name']);
        $this->assertEquals(TenantLoginProviderSourceOptions::GOOGLE, $json['source']);
        $this->assertEquals(true, $json['disabled']);
        $this->assertEquals(true, $json['directAccess']);
        $this->assertEquals('one', $json['publicKey']);
        $this->assertEquals('one', $json['privateKey']);
        $this->assertEquals(true, $json['usersEnabledByDefault']);
        $this->assertEquals(1, $json['version']);
    }
    public function test_create_store_values(): void
    {
        // @Arrange
        $one = new TenantLoginProvider(
            uid: 'one',
            tenant: new TenantRef('one'),
            name: 'one',
            source: TenantLoginProviderSourceOptions::GOOGLE,
            disabled: true,
            directAccess: true,
            publicKey: 'one',
            privateKey: 'one',
            certificate: 'one',
            metadata: 'store://bin',
            usersEnabledByDefault: true,
            version: 1,
        );

        // @Act
        $other = TenantLoginProvider::create($one->toAttributes());

        // @Assert
        $this->assertEquals($one->uid(), $other->uid());
        $this->assertEquals($one->getTenant(), $other->getTenant());
        $this->assertTrue($one->isTenantChanged());
        $this->assertEquals($one->getName(), $other->getName());
        $this->assertTrue($one->isNameChanged());
        $this->assertEquals($one->getSource(), $other->getSource());
        $this->assertTrue($one->isSourceChanged());
        $this->assertEquals($one->isDirectAccess(), $other->isDirectAccess());
        $this->assertTrue($one->isDirectAccessChanged());
        $this->assertEquals($one->getPublicKey(), $other->getPublicKey());
        $this->assertTrue($one->isPublicKeyChanged());
        $this->assertEquals($one->getPrivateKey(), $other->getPrivateKey());
        $this->assertTrue($one->isPrivateKeyChanged());
        $this->assertEquals($one->getCertificate(), $other->getCertificate());
        $this->assertTrue($one->isCertificateChanged());
        $this->assertEquals($one->getMetadata(), $other->getMetadata());
        $this->assertTrue($one->isMetadataChanged());
        $this->assertEquals($one->isUsersEnabledByDefault(), $other->isUsersEnabledByDefault());
        $this->assertTrue($one->isUsersEnabledByDefaultChanged());
        $this->assertEquals($one->getVersion(), $other->getVersion());
        $this->assertTrue($one->isVersionChanged());
        $this->assertCount(0, $one->getTheEvents());
        $this->assertCount(1, $other->getTheEvents());
    }
    public function test_update_change_values(): void
    {
        $base = new TenantLoginProvider(
            uid: 'one',
            tenant: new TenantRef('one'),
            name: 'one',
            source: TenantLoginProviderSourceOptions::GOOGLE,
            disabled: true,
            directAccess: true,
            publicKey: 'one',
            privateKey: 'one',
            certificate: 'one',
            metadata: 'store://bin',
            usersEnabledByDefault: true,
            version: 1,
        );
        $other = new TenantLoginProvider(
            uid: 'other',
            tenant: new TenantRef('other'),
            name: 'other',
            source: TenantLoginProviderSourceOptions::GITHUB,
            disabled: false,
            directAccess: false,
            publicKey: 'other',
            privateKey: 'other',
            certificate: 'other',
            metadata: 'store://obin',
            usersEnabledByDefault: false,
            version: 2,
        );

        // @Act
        $one = $base->update($other->toAttributes());

        // @Assert
        $this->assertEquals($one->uid(), $base->uid());
        $this->assertEquals($one->getTenant(), $other->getTenant());
        $this->assertTrue($one->isTenantChanged($base));
        $this->assertEquals($one->getName(), $other->getName());
        $this->assertTrue($one->isNameChanged($base));
        $this->assertEquals($one->getSource(), $other->getSource());
        $this->assertTrue($one->isSourceChanged($base));
        $this->assertEquals($one->isDirectAccess(), $other->isDirectAccess());
        $this->assertTrue($one->isDirectAccessChanged($base));
        $this->assertEquals($one->getPublicKey(), $other->getPublicKey());
        $this->assertTrue($one->isPublicKeyChanged($base));
        $this->assertEquals($one->getPrivateKey(), $other->getPrivateKey());
        $this->assertTrue($one->isPrivateKeyChanged($base));
        $this->assertEquals($one->getCertificate(), $other->getCertificate());
        $this->assertTrue($one->isCertificateChanged($base));
        $this->assertEquals($one->getMetadata(), $other->getMetadata());
        $this->assertTrue($one->isMetadataChanged($base));
        $this->assertEquals($one->isUsersEnabledByDefault(), $other->isUsersEnabledByDefault());
        $this->assertTrue($one->isUsersEnabledByDefaultChanged($base));
        $this->assertEquals($one->getVersion(), $other->getVersion());
        $this->assertTrue($one->isVersionChanged($base));
        $this->assertCount(0, $other->getTheEvents());
        $this->assertCount(1, $one->getTheEvents());
    }
    public function test_delete_store_values(): void
    {
        // @Arrange
        $one = new TenantLoginProvider(
            uid: 'one',
            tenant: new TenantRef('one'),
            name: 'one',
            source: TenantLoginProviderSourceOptions::GOOGLE,
            disabled: true,
            directAccess: true,
            publicKey: 'one',
            privateKey: 'one',
            certificate: 'one',
            metadata: 'store://bin',
            usersEnabledByDefault: true,
            version: 1,
        );

        // @Act
        $other = $one->delete();

        // @Assert
        $this->assertEquals($one->uid(), $other->uid());
        $this->assertEquals($one->getTenant(), $other->getTenant());
        $this->assertTrue($one->isTenantChanged());
        $this->assertEquals($one->getName(), $other->getName());
        $this->assertTrue($one->isNameChanged());
        $this->assertEquals($one->getSource(), $other->getSource());
        $this->assertTrue($one->isSourceChanged());
        $this->assertEquals($one->isDirectAccess(), $other->isDirectAccess());
        $this->assertTrue($one->isDirectAccessChanged());
        $this->assertEquals($one->getPublicKey(), $other->getPublicKey());
        $this->assertTrue($one->isPublicKeyChanged());
        $this->assertEquals($one->getPrivateKey(), $other->getPrivateKey());
        $this->assertTrue($one->isPrivateKeyChanged());
        $this->assertEquals($one->getCertificate(), $other->getCertificate());
        $this->assertTrue($one->isCertificateChanged());
        $this->assertEquals($one->getMetadata(), $other->getMetadata());
        $this->assertTrue($one->isMetadataChanged());
        $this->assertEquals($one->isUsersEnabledByDefault(), $other->isUsersEnabledByDefault());
        $this->assertTrue($one->isUsersEnabledByDefaultChanged());
        $this->assertEquals($one->getVersion(), $other->getVersion());
        $this->assertTrue($one->isVersionChanged());
    }
    public function test_enable_modify(): void
    {
        // @Arrange
        $source = new TenantLoginProvider(
            uid: 'one',
            tenant: new TenantRef('one'),
            name: 'one',
            source: TenantLoginProviderSourceOptions::GOOGLE,
            disabled: true,
            directAccess: true,
            publicKey: 'one',
            privateKey: 'one',
            certificate: 'one',
            metadata: 'store://bin',
            usersEnabledByDefault: true,
            version: 1,
        );
        $sourceDisabled = true;
        $targetDisabled = false;
        $source = $source->withDisabled($sourceDisabled);

        // @Act
        $target = $source->enable();

        // @Assert
        $this->assertEquals(true, $source->isDisabled());
        $this->assertEquals($targetDisabled, $target->isDisabled());
        $this->assertNotEquals($sourceDisabled, $target->isDisabled());
    }
    public function test_disable_modify(): void
    {
        // @Arrange
        $source = new TenantLoginProvider(
            uid: 'one',
            tenant: new TenantRef('one'),
            name: 'one',
            source: TenantLoginProviderSourceOptions::GOOGLE,
            disabled: true,
            directAccess: true,
            publicKey: 'one',
            privateKey: 'one',
            certificate: 'one',
            metadata: 'store://bin',
            usersEnabledByDefault: true,
            version: 1,
        );
        $sourceDisabled = false;
        $targetDisabled = true;
        $source = $source->withDisabled($sourceDisabled);

        // @Act
        $target = $source->disable();

        // @Assert
        $this->assertEquals(false, $source->isDisabled());
        $this->assertEquals($targetDisabled, $target->isDisabled());
        $this->assertNotEquals($sourceDisabled, $target->isDisabled());
    }
}
