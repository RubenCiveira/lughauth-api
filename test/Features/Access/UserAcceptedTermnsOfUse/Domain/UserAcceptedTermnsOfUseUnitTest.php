<?php

# @autogenerated
declare(strict_types=1);

use Civi\Lughauth\Features\Access\User\Domain\UserRef;
use Civi\Lughauth\Features\Access\TenantTermsOfUse\Domain\TenantTermsOfUseRef;
use PHPUnit\Framework\TestCase;
use Civi\Lughauth\Features\Access\UserAcceptedTermnsOfUse\Domain\UserAcceptedTermnsOfUse;

final class UserAcceptedTermnsOfUseUnitTest extends TestCase
{
    public function test_init_store_values(): void
    {
        // @Arrange
        $one = new UserAcceptedTermnsOfUse(
            uid: 'one',
            user: $this->getMockBuilder(UserRef::class)->setConstructorArgs(['one'])->getMock(),
            conditions: $this->getMockBuilder(TenantTermsOfUseRef::class)->setConstructorArgs(['one'])->getMock(),
            acceptDate: (new \DateTimeImmutable('1980-08-20T14:32:45.123Z')),
            version: 1,
        );

        // @Act
        $other = $one->toAttributes()->build();

        // @Assert
        $this->assertEquals($one->uid(), $other->uid());
        $this->assertEquals($one->getUser(), $other->getUser());
        $this->assertTrue($one->isUserChanged());
        $this->assertEquals($one->getConditions(), $other->getConditions());
        $this->assertTrue($one->isConditionsChanged());
        $this->assertEquals($one->getAcceptDate(), $other->getAcceptDate());
        $this->assertTrue($one->isAcceptDateChanged());
        $this->assertEquals($one->getVersion(), $other->getVersion());
        $this->assertTrue($one->isVersionChanged());
    }
    public function test_replace_change_values(): void
    {
        // @Arrange
        $base = new UserAcceptedTermnsOfUse(
            uid: 'one',
            user: $this->getMockBuilder(UserRef::class)->setConstructorArgs(['one'])->getMock(),
            conditions: $this->getMockBuilder(TenantTermsOfUseRef::class)->setConstructorArgs(['one'])->getMock(),
            acceptDate: (new \DateTimeImmutable('1980-08-20T14:32:45.123Z')),
            version: 1,
        );
        $other = new UserAcceptedTermnsOfUse(
            uid: 'other',
            user: $this->getMockBuilder(UserRef::class)->setConstructorArgs(['other'])->getMock(),
            conditions: $this->getMockBuilder(TenantTermsOfUseRef::class)->setConstructorArgs(['other'])->getMock(),
            acceptDate: (new \DateTimeImmutable('1981-09-06T14:32:45.123Z')),
            version: 2,
        );

        // @Act
        $one = $base->replace($other->toAttributes());

        // @Assert
        $this->assertEquals($one->uid(), $base->uid());
        $this->assertEquals($one->getUser(), $other->getUser());
        $this->assertTrue($one->isUserChanged($base));
        $this->assertEquals($one->getConditions(), $other->getConditions());
        $this->assertTrue($one->isConditionsChanged($base));
        $this->assertEquals($one->getAcceptDate(), $other->getAcceptDate());
        $this->assertTrue($one->isAcceptDateChanged($base));
        $this->assertEquals($one->getVersion(), $other->getVersion());
        $this->assertTrue($one->isVersionChanged($base));
    }
    public function test_create_store_values(): void
    {
        // @Arrange
        $one = new UserAcceptedTermnsOfUse(
            uid: 'one',
            user: $this->getMockBuilder(UserRef::class)->setConstructorArgs(['one'])->getMock(),
            conditions: $this->getMockBuilder(TenantTermsOfUseRef::class)->setConstructorArgs(['one'])->getMock(),
            acceptDate: (new \DateTimeImmutable('1980-08-20T14:32:45.123Z')),
            version: 1,
        );

        // @Act
        $other = UserAcceptedTermnsOfUse::create($one->toAttributes());

        // @Assert
        $this->assertEquals($one->uid(), $other->uid());
        $this->assertEquals($one->getUser(), $other->getUser());
        $this->assertTrue($one->isUserChanged());
        $this->assertEquals($one->getConditions(), $other->getConditions());
        $this->assertTrue($one->isConditionsChanged());
        $this->assertEquals($one->getAcceptDate(), $other->getAcceptDate());
        $this->assertTrue($one->isAcceptDateChanged());
        $this->assertEquals($one->getVersion(), $other->getVersion());
        $this->assertTrue($one->isVersionChanged());
        $this->assertCount(0, $one->getTheEvents());
        $this->assertCount(1, $other->getTheEvents());
    }
    public function test_update_change_values(): void
    {
        $base = new UserAcceptedTermnsOfUse(
            uid: 'one',
            user: $this->getMockBuilder(UserRef::class)->setConstructorArgs(['one'])->getMock(),
            conditions: $this->getMockBuilder(TenantTermsOfUseRef::class)->setConstructorArgs(['one'])->getMock(),
            acceptDate: (new \DateTimeImmutable('1980-08-20T14:32:45.123Z')),
            version: 1,
        );
        $other = new UserAcceptedTermnsOfUse(
            uid: 'other',
            user: $this->getMockBuilder(UserRef::class)->setConstructorArgs(['other'])->getMock(),
            conditions: $this->getMockBuilder(TenantTermsOfUseRef::class)->setConstructorArgs(['other'])->getMock(),
            acceptDate: (new \DateTimeImmutable('1981-09-06T14:32:45.123Z')),
            version: 2,
        );

        // @Act
        $one = $base->update($other->toAttributes());

        // @Assert
        $this->assertEquals($one->uid(), $base->uid());
        $this->assertEquals($one->getUser(), $other->getUser());
        $this->assertTrue($one->isUserChanged($base));
        $this->assertEquals($one->getConditions(), $other->getConditions());
        $this->assertTrue($one->isConditionsChanged($base));
        $this->assertEquals($one->getAcceptDate(), $other->getAcceptDate());
        $this->assertTrue($one->isAcceptDateChanged($base));
        $this->assertEquals($one->getVersion(), $other->getVersion());
        $this->assertTrue($one->isVersionChanged($base));
        $this->assertCount(0, $other->getTheEvents());
        $this->assertCount(1, $one->getTheEvents());
    }
    public function test_delete_store_values(): void
    {
        // @Arrange
        $one = new UserAcceptedTermnsOfUse(
            uid: 'one',
            user: $this->getMockBuilder(UserRef::class)->setConstructorArgs(['one'])->getMock(),
            conditions: $this->getMockBuilder(TenantTermsOfUseRef::class)->setConstructorArgs(['one'])->getMock(),
            acceptDate: (new \DateTimeImmutable('1980-08-20T14:32:45.123Z')),
            version: 1,
        );

        // @Act
        $other = $one->delete();

        // @Assert
        $this->assertEquals($one->uid(), $other->uid());
        $this->assertEquals($one->getUser(), $other->getUser());
        $this->assertTrue($one->isUserChanged());
        $this->assertEquals($one->getConditions(), $other->getConditions());
        $this->assertTrue($one->isConditionsChanged());
        $this->assertEquals($one->getAcceptDate(), $other->getAcceptDate());
        $this->assertTrue($one->isAcceptDateChanged());
        $this->assertEquals($one->getVersion(), $other->getVersion());
        $this->assertTrue($one->isVersionChanged());
    }
}
