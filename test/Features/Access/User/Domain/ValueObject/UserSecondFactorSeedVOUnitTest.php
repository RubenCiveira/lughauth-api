<?php

# @autogenerated
declare(strict_types=1);

use PHPUnit\Framework\TestCase;
use Civi\Lughauth\Shared\Exception\ConstraintException;
use Civi\Lughauth\Shared\Value\Validation\ConstraintFailList;
use Civi\Lughauth\Features\Access\User\Domain\ValueObject\UserSecondFactorSeedVO;
use Civi\Lughauth\Shared\Security\AesCypherService;

final class UserSecondFactorSeedVOUnitTest extends TestCase
{
    public function test_asignation_keep_value(): void
    {
        $value = 'cyphered://cypher';
        $ref = UserSecondFactorSeedVO::from($value);
        $this->assertEquals('****er', $ref->value());
        $other = UserSecondFactorSeedVO::tryFrom($ref, new ConstraintFailList());
        $this->assertSame($other, $ref);
        $more = UserSecondFactorSeedVO::from($ref);
        $this->assertSame($more, $ref);
    }
    public function test_asignation_invalid_type(): void
    {
        $errors = new ConstraintFailList();
        $other = UserSecondFactorSeedVO::tryFrom(1, $errors);
        $this->assertNull($other);
        $this->assertTrue($errors->hasErrors());
    }
    public function test_empty(): void
    {
        $ref = UserSecondFactorSeedVO::empty();
        $this->assertNull($ref->value());
    }
    public function test_try_from_empty(): void
    {
        $ref = UserSecondFactorSeedVO::tryFrom(null, new ConstraintFailList());
        $this->assertNull($ref->value());
    }
    public function test_cypher_builders(): void
    {
        $aes = $this->createMock(AesCypherService::class);
        $aes->method('encryptForAll')->willReturn('encripted');
        $aes->method('decryptForAll')->willReturn('decript');
        $errors = new ConstraintFailList();
        $value = UserSecondFactorSeedVO::fromCypheredText($aes, 'gold');
        $this->assertEquals('****ld', $value->value());
        $this->assertEquals('gold', $value->cypheredValueWith($aes));
        $this->assertEquals('decript', $value->plainValueWith($aes));
        $value = UserSecondFactorSeedVO::tryFromCypheredText($aes, 'gold', $errors);
        $this->assertEquals('****ld', $value->value());
        $this->assertEquals('gold', $value->cypheredValueWith($aes));
        $this->assertEquals('decript', $value->plainValueWith($aes));
        $this->assertTrue($errors->isEmpty());
    }
    public function test_plain_but_cypher_builders(): void
    {
        $aes = $this->createMock(AesCypherService::class);
        $aes->method('encryptForAll')->willReturn('encripted');
        $aes->method('decryptForAll')->willReturn('decript');
        $errors = new ConstraintFailList();
        $value = UserSecondFactorSeedVO::fromPlainText($aes, 'cyphered://gold');
        $this->assertEquals('****ld', $value->value());
        $this->assertEquals('gold', $value->cypheredValueWith($aes));
        $this->assertEquals('decript', $value->plainValueWith($aes));
        $value = UserSecondFactorSeedVO::tryFromPlainText($aes, 'cyphered://gold', $errors);
        $this->assertEquals('****ld', $value->value());
        $this->assertEquals('gold', $value->cypheredValueWith($aes));
        $this->assertEquals('decript', $value->plainValueWith($aes));
        $this->assertTrue($errors->isEmpty());
    }
    public function test_plain_builders(): void
    {
        $aes = $this->createMock(AesCypherService::class);
        $aes->method('encryptForAll')->willReturn('encripted');
        $aes->method('decryptForAll')->willReturn('decript');
        $errors = new ConstraintFailList();
        $value = UserSecondFactorSeedVO::fromPlainText($aes, 'gold');
        $this->assertEquals('****ed', $value->value());
        $this->assertEquals('encripted', $value->cypheredValueWith($aes));
        $this->assertEquals('decript', $value->plainValueWith($aes));
        $value = UserSecondFactorSeedVO::tryFromPlainText($aes, 'gold', $errors);
        $this->assertEquals('****ed', $value->value());
        $this->assertEquals('encripted', $value->cypheredValueWith($aes));
        $this->assertEquals('decript', $value->plainValueWith($aes));
        $this->assertTrue($errors->isEmpty());
    }
    public function test_uncypgere_build_has_error(): void
    {
        $this->expectException(\InvalidArgumentException::class);
        UserSecondFactorSeedVO::from('none');
    }
    public function test_exception_on_wrong_value_1(): void
    {
        $this->expectException(ConstraintException::class);
        UserSecondFactorSeedVO::from('Lorem ipsum dolor sit amet, consectetur adipiscing elit. Vivamus in consectetur purus, sit amet rutrum mi. Vestibulum finibus velit ac ligula feugiat, fermentum mattis justo pretium. Nullam blandit nibh nec tortor ultricies, sit amet pretium tellus ullamcorper. Nulla eu bibendum quam, sed vestibulum est. Nunc vitae imperdiet turpis, vel maximus massa. Mauris vel egestas odio. Sed malesuada a lorem non rhoncus. In sagittis scelerisque risus nec consectetur. In est neque, efficitur ut blandit ut, accumsan vitae sem.');
    }
}
